<!DOCTYPE html><!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="ru"> <![endif]--><!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang="ru"> <![endif]--><!--[if IE 8]>         <html class="no-js lt-ie9" lang="ru"> <![endif]--><!--[if gt IE 8]><!--> <html class="no-js" lang="ru"> <!--<![endif]--><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#"> <meta charset="utf-8">  <title>Эффективное сквозное тестирование с Protractor | Блог Makeomatic: разработка сайтов и мобильных приложений</title> <meta name="author" content="Makeomatic">  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"> <!-- For third-generation iPad with high-resolution Retina display: --> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144x144-precomposed.png"> <!-- For iPhone with high-resolution Retina display running iOS ≥ 7: --> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/apple-touch-icon-120x120-precomposed.png"> <!-- For iPhone with high-resolution Retina display running iOS ≤ 6: --> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/apple-touch-icon-114x114-precomposed.png"> <!-- For first- and second-generation iPad: --> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/apple-touch-icon-72x72-precomposed.png"> <!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: --> <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"> <meta name="description" content="С AngularJS действительно удобно работать, поскольку тестам изначально придаётся большое значение - каждое изменение, внесённое в исходники, тестируется перед сохранением в ядро.">
<meta name="keywords" content="Javascript,AngularJS">
<meta property="og:type" content="article">
<meta property="og:title" content="Эффективное сквозное тестирование с Protractor">
<meta property="og:url" content="https://makeomatic.ru/blog/2015/01/05/Protractor_testing/index.html">
<meta property="og:site_name" content="Блог Makeomatic: разработка сайтов и мобильных приложений">
<meta property="og:description" content="С AngularJS действительно удобно работать, поскольку тестам изначально придаётся большое значение - каждое изменение, внесённое в исходники, тестируется перед сохранением в ядро.">
<meta property="og:image" content="https://makeomatic.ru/blog/images/Protractor_testing.png">
<meta property="og:updated_time" content="2016-01-08T17:55:51.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Эффективное сквозное тестирование с Protractor">
<meta name="twitter:description" content="С AngularJS действительно удобно работать, поскольку тестам изначально придаётся большое значение - каждое изменение, внесённое в исходники, тестируется перед сохранением в ядро.">
<meta name="twitter:image" content="https://makeomatic.ru/blog/images/Protractor_testing.png">
<meta name="twitter:creator" content="@makeomatic">
<link rel="publisher" href="https://plus.google.com/+MakeomaticRu">  <link rel="alternate" hreflang="ru" href="https:&#47;&#47;makeomatic.ru&#47;blog&#47;2015&#47;01&#47;05&#47;Protractor_testing&#47;" />   <meta property="og:image:width" content="540" /> <meta property="og:image:height" content="514" />  <link href='//fonts.googleapis.com/css?family=Roboto:300,700&subset=latin,cyrillic,cyrillic-ext' rel='stylesheet' type='text/css'>  <link rel="stylesheet" href="/css/app.min.2.3.1.css">  <script src="/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script> <!-- place this in your head tag --> <!-- <script src='https://js.tito.io/v1' async></script> --> <!-- <link rel="stylesheet" type="text/css" href='https://css.tito.io/v1' /> --></head><body data-spy="scroll" data-target=".navbar" data-offset="150"><!--[if lt IE 8]><p class="chromeframe">Вы используете <strong>устаревший</strong> браузер. Пожалуйста <a href="http://browsehappy.com/">обновите ваш браузер</a> или <a href="http://www.google.com/chromeframe/?redirect=true">активируйте Google Chrome Frame</a>, чтобы улучшить ваши впечатления от посещения сайта.</p><![endif]--><header class="navbar navbar-inverse navbar-fixed-top"> <div class="navbar-inner"> <div class="container"> <div class="social-desktop"> <a class="fcb" href="https://www.facebook.com/makeomatic"> <i class="fa fa-facebook"></i> </a> <a class="vk" href="https://vk.com/makeomatic"> <i class="fa fa-vk"></i> </a> <a class="twt" href="https://twitter.com/MakeOmatic"> <i class="fa fa-twitter"></i> </a> <a class="gp" href="https://google.com/+MakeomaticRu"> <i class="fa fa-google-plus-square"></i> </a> </div> <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a> <a class="brand" href="/">makeomatic</a> <div class="nav-collapse collapse"> <ul class="nav">   <li class='active '> <a href="/blog" > Блог  </a>  </li>   <li class=' dropdown'> <a href="/team" data-target="#" class="dropdown-toggle" data-toggle="dropdown"> Команда  <b class='caret'></b>  </a>  <ul class='dropdown-menu'>   <li> <a href="/team#vyacheslavgusev">Вячеслав Гусев</a> </li>   <li> <a href="/team#vitaliiaminev">Виталий Аминев</a> </li>   <li> <a href="/team#annaamineva">Анна Аминева</a> </li>   <li> <a href="/team#andreiafoninskii">Андрей Афонинский</a> </li>   <li> <a href="/team#aleksandrkremenets">Александр Кременец</a> </li>   <li> <a href="/team#dmitriigorbunov">Дмитрий Горбунов</a> </li>   <li> <a href="/team#evgeniipoyarkov">Евгений Поярков</a> </li>   <li> <a href="/team#ilyaovsyannikov">Илья Овсянников</a> </li>  </ul>  </li>   <li class=' '> <a href="/#about" > О нас  </a>  </li>   <li class=' dropdown'> <a href="/#portfolio" data-target="#" class="dropdown-toggle" data-toggle="dropdown"> Портфолио  <b class='caret'></b>  </a>  <ul class='dropdown-menu'>   <li> <a href="/#Distribut.io">Distribut.io</a> </li>   <li> <a href="/#Recordi">Recordi</a> </li>   <li> <a href="/#Photobot">Photobot</a> </li>   <li> <a href="/#BrainsApp">BrainsApp</a> </li>   <li> <a href="/#FabrikaTepla">FabrikaTepla</a> </li>   <li> <a href="/#SpeakGeo">SpeakGeo</a> </li>   <li> <a href="/#OpenInclude">OpenInclude</a> </li>   <li> <a href="/#LIVEONE">LIVEONE</a> </li>   <li> <a href="/#FitCafe">FitCafe</a> </li>  </ul>  </li>   <li class=' '> <a href="/#tech" > Технологии  </a>  </li>   <li class=' '> <a href="#contacts" > Контакты  </a>  </li>  </ul> </div><!--/.nav-collapse --> <div class='send-brief' > <a href='#brief' role='button' data-toggle='modal'> <i class='background'></i> <span>Заполнить бриф</span> </a> </div> <h4 class='phone-desktop'> Звоните: +7 (495) 79-222-44 </h4> </div> </div></header><div class="icon-up visible-desktop" id="up" title="наверх"></div><section class="container blog" id='blog'> <h1 class='outlined-caption text-center'> <a href='/blog'>Блог Makeomatic: разработка сайтов и мобильных приложений</a> </h1>  <div class='row'> <div class='span10'><article class="post"> <div class="post-content"> <header class='post-header'>   <h2 class="title">Эффективное сквозное тестирование с Protractor</h2> <p class='muted'>Часть 1</p>   <div class="icon"></div> <time datetime="2015-01-05T08:00:00.000Z"> Jan 5 2015 </time>   <div class="tags"> | Категории: <a href="/blog/tags/Javascript/">Javascript</a>, <a href="/blog/tags/AngularJS/">AngularJS</a> </div> <span class='author'><img src='//www.gravatar.com/avatar/533bf2bc5b98773298fa3715a5e286ee?s=20' /> Eleonora Pavlova</span>  </header> <section class="body">  <p><img src="/blog/images/Protractor_testing.png" alt="Иллюстрация блокнота"></p>
<p>С AngularJS действительно удобно работать, поскольку тестам изначально придаётся большое значение - каждое изменение, внесённое в исходники, тестируется перед сохранением в ядро.</p>
<a id="more"></a>
<p>Тестирование крайне важно, особенно в Javascript - языке с динамической проверкой типов. Тесты позволяют отловить ошибки до того, как они попадут в продакшн. Уже не говоря о том, что они повышают качество кода.</p>
<p>Баги неизбежны в любом коде, и наша задача уметь их отыскать и постараться починить до  того, как они проявят себя в конечном продукте. В тестовой среде появляется возможность изолировать части функционала и «пощупать» приложение изнутри.</p>
<h4 id="Тестирование-—-неотъемлемая-часть-работы-если-мы-хотим-понимать-что-происходит-в-приложении"><a href="#Тестирование-—-неотъемлемая-часть-работы-если-мы-хотим-понимать-что-происходит-в-приложении" class="headerlink" title="Тестирование — неотъемлемая часть работы, если мы хотим понимать, что происходит в приложении."></a>Тестирование — неотъемлемая часть работы, если мы хотим понимать, что происходит в приложении.</h4><p>В данной статье мы рассмотрим сквозное (e2e) тестирование приложений. Сквозное тестирование — это поведенческое тестирование по методу «чёрного ящика» (проверка выполнения приложением заданных функциональных требований, при которой не используются знания о внутренней структуре тестируемого объекта). То есть мы тестируем, что система работает, как планировалось, с точки зрения конечного пользователя.</p>
<p>Пользователю всё равно, работает ли приложение «как планировалось», ему важно, чтобы функционал работал в соответствии с его собственными ожиданиями. Тестирование по сути это  автоматизированный запуск приложения в браузере и последовательные действия, проверяющие весь функционал пользовательского интерфейса. Совершать все эти действия вручную было бы крайне неэффективно, поэтому создадим автоматические тесты.</p>
<h3 id="Автоматизация-с-помощью-Protractor"><a href="#Автоматизация-с-помощью-Protractor" class="headerlink" title="Автоматизация с помощью Protractor"></a>Автоматизация с помощью Protractor</h3><p>Protractor –  рекомендуемый фреймворк для сквозного тестирования.  В отличие от стандартного исполнителя сценариев Angular, Protractor сделан на основе Selenium <a href="https://code.google.com/p/selenium/wiki/WebDriverJs" target="_blank" rel="external">WebDriver</a> - инструмента для автоматизированного тестирования веб-приложений, с API и набором расширений, позволяющих управлять поведением браузера. Расширения WebDriver есть для всех типов браузеров, включая наиболее популярные. Таким образом, мы получаем быстрое и стабильное тестирование в реальной браузерной среде.</p>
<p>К счастью, Protractor работает в связке с Jasmine, так что тем, кто знаком с этим фреймворком, не придётся изучать новый. Но можно установить его и как самостоятельный исполнитель тестов или использовать как библиотеку.</p>
<h3 id="Установка"><a href="#Установка" class="headerlink" title="Установка"></a>Установка</h3><p>В отличие от стандартного исполнителя сценариев, для работы Protractor нужно запустить отдельный сервер по адресу  <code>http://location:4444</code> (можно перенастроить). К счастью, в дистрибутиве Protractor имеется утилита, упрощающая процесс установки Selenium Server. Чтобы воспользоваться скриптом, необходимо установить Protractor локально в корневой каталог тестируемого Angular приложения.</p>
<p><code>$ npm install protractor</code></p>
<p>Далее запускаем скрипт-загрузчик Selenium (расположен в локальном каталоге <code>node_modules/</code>) командой:</p>
<p><code>$ ./node_modules/protractor/bin/webdriver-manager update</code></p>
<p>Этот скрипт загружает файлы, необходимые для запуска Selenium, и создаёт соответствующий каталог. Когда всё загружено, запускаем Selenium с драйвером Chrome командой старт:</p>
<p><code>$ ./node_modules/protractor/bin/webdriver-manager start</code></p>
<p>Если у вас возникают проблемы при запуске Selenium, попробуйте обновить ChromeDriver, загрузив последнюю версию <a href="http://chromedriver.storage.googleapis.com/" target="_blank" rel="external">здесь</a>.</p>
<p>Теперь можем работать с Protractor, подключившись к серверу Selenium, который работает в фоновом режиме.</p>
<h3 id="Настройка"><a href="#Настройка" class="headerlink" title="Настройка"></a>Настройка</h3><p>Наподобие таск-раннера Karma, для запуска и работы с Selenium нужен конфигурационный файл.  Наиболее простой способ создания конфигурационного файла Protractor - скопировать базовую конфигурацию из каталога установки.</p>
<p><code>$ cp ./node_modules/protractor/example/chromeOnlyConf.js protractor_conf.js</code></p>
<p>Для старта Protractor в файле необходимо сделать несколько изменений. Во-первых,  по умолчанию конфигурационный файл использует драйвер Chrome, которого нет в текущей директории. Поэтому мы должны указать путь к драйверу в локальной папке <code>./node_modules</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chromeDriver: <span class="string">'./node_modules/protractor/selenium/chromedriver'</span>,</div></pre></td></tr></table></figure>
<p>Далее нужно изменить путь массива specs, указав на наши локальные тесты.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">specs: [<span class="string">'test/e2e/**/*_spec.js'</span>],</div></pre></td></tr></table></figure>
<p>При настройке тестов в Protractor существует множество различных параметров конфигурации. В этой статье мы затронем некоторые из них, но помните, что существует и немало других опций.</p>
<p>Есть два варианта запуска тестов. Первый, автономный режим — использовать Protractor для запуска Selenium, когда запускаем наши тесты. Пример файла конфигурации в данной статье использует этот метод.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chromeOnly: <span class="literal">true</span>,</div><div class="line"><span class="attr">chromeDriver</span>: <span class="string">'./node_modules/protractor/selenium/chromedriver'</span>,</div></pre></td></tr></table></figure>
<p>Второй вариант предполагает подключение к отдельно запущенному серверу Selenium. Когда тесты становятся более сложными, вероятно, целесообразнее использовать этот вариант.</p>
<p>В этом случае нужно удалить указанные выше настройки (chromeOnly и chromeDriver), и добавить параметр seleniumAddress, указывающий путь к запущенному серверу Selenium:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">seleniumAddress: <span class="string">'http://0.0.0.0:4444/wd/hub'</span>,</div></pre></td></tr></table></figure>
<h3 id="Написание-тестов"><a href="#Написание-тестов" class="headerlink" title="Написание тестов"></a>Написание тестов</h3><p>При написании тестов в Protractor используется фреймворк Jasmine. То есть мы пишем тесты точно так же, как для Karma. Пример простого теста в Protractor:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">describe(<span class="string">'homepage'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  beforeEach(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// функция before</span></div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  it(<span class="string">'should load the page'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// далее тест</span></div><div class="line">    expect(...).toEqual(<span class="string">'hello'</span>);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>В примере приведён не полный код, но структура узнаваема — синтаксис Jasmine. Для создания структуры тестов используем функции <code>beforeEach()</code>, <code>afterEach()</code>  и вложенные блоки <code>describe()</code>. Для выполнения тестов используем синтаксис Jasmine – <code>expect()</code>.<br>При написании тестов в Protractor нам понабодятся некоторые его глобальные переменные. Ниже приведены некоторые из них.<br>browser – оболочка вебдрайвера, используется для навигации и получения информации о странице.</p>
<h4 id="Browser"><a href="#Browser" class="headerlink" title="Browser"></a>Browser</h4><p>Можем использовать переменную browser для перехода на страницу с помощью функции <code>get()</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">beforeEach(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  browser.get(<span class="string">'http://127.0.0.1:9000/'</span>);</div><div class="line">&#125;);</div><div class="line">С объектом browser можно также проделывать разные штуки. Например, дебаггинг с помощью метода <span class="keyword">debugger</span>() :</div><div class="line">it(<span class="string">'should find title element'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  browser.get(<span class="string">'app/index.html'</span>);</div><div class="line"></div><div class="line">  browser.debugger();</div><div class="line"></div><div class="line">  element(by.binding(<span class="string">'user.name'</span>));</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Для использования этого теста в отладчике node, запускаем его в режиме отладки:</p>
<p><code>$ protractor debug conf.js</code></p>
<p>Запуская Protractor в режиме отладки, мы получаем бонус — выполнение в браузере останавливается, и теперь все клиентские скрипты Protractor доступны нам из консоли. Чтобы получить к ним доступ, нужно вызвать объект Protractor – <code>window.clientSideScripts.</code></p>
<h3 id="Начнём-тестировать"><a href="#Начнём-тестировать" class="headerlink" title="Начнём тестировать!"></a>Начнём тестировать!</h3><p>Можно долго рассказывать о том, для чего нужно использовать Protractor, гораздо сложнее его нормально настроить. Тк мы стремимся к высокому качеству материалов по Angular, давайте уже углубимся в тестирование приложения и различные стратегии.</p>
<h3 id="Наше-приложение"><a href="#Наше-приложение" class="headerlink" title="Наше приложение"></a>Наше приложение</h3><p>Давайте для примера возьмём приложение, реализующее свой вариант просмотра <a href="https://github.com/" target="_blank" rel="external">Github issues</a>. Простое приложение, у которого всего несколько функций:</p>
<ul>
<li>Оно позволяет указывать владельца репозитория и URL через окно ввода;</li>
<li>В нём имеется главная страница и страница About;</li>
<li>issues упорядочены друг под другом;</li>
<li>используется Gravatar пользователя.</li>
</ul>
<p>Наше конечное приложение выглядит вот так (картинка 1 a, b - из статьи):</p>
<p><img src="/blog/images/protractor1.png" alt="Иллюстрация блокнота"></p>
<p><img src="/blog/images/protractor2.png" alt="Иллюстрация блокнота"></p>
<p>При написании тестов для каждого приложения необходимо продумать стратегию.  Можно написать слишком много тестов для очень простого приложения, а можно, наоборот, слишком мало. Найдя правильный баланс между двумя крайностями, мы здорово поможем себе, когда возьмёмся за реализацию приложения и тестов к нему.  </p>
<h3 id="Стратегия-тестирования"><a href="#Стратегия-тестирования" class="headerlink" title="Стратегия тестирования"></a>Стратегия тестирования</h3><p>По опыту, наилучший баланс между написанием тестов и написанием кода достигается тогда, когда вы чётко понимаете, что тестировать и как именно тестировать. Когда мы пишем тест, важно, чтобы он проверял именно то поведение, которое задумано. То есть, мы не должны писать тест, чтобы проверить, меняется ли содержание тэга <code>h1</code>,  потому что мы вводим текст в поле <code>&lt;input&gt;</code>.  А вот проверить фильтрацию нашей фичи «поиск в режиме реального времени» (Live Search) нужно.</p>
<p>Мы пришли к выводу, что писать тесты заранее, на стадии прототипирования, не имеет смысла. В этой стадии можно написать пару тестов максимум, потому что мы всё ещё продумываем функции нашего приложения. А вот по мере роста приложения уже стоит писать больше тестов, чтобы убедиться, что оно ведёт себя так, как задумано в продакшене.</p>
<p>Наконец, нужно структурировать тесты так, чтобы каждый блок проверял какую-то свою, очень маленькую задачу. В идеале тест должен проверять не более 1 ожидаемого события.</p>
<p>Ну, хватит теории, применим стратегию на практике.</p>
<p>Во-первых, нужно проверить, что наше приложение добавляет название репозитория, с которым мы будем работать. Используя функционал Angular, приложение делает <code>http</code> запрос к <code>github.com</code>. Этот запрос возвращается, и мы заполняем оставшиеся поля главной страницы.</p>
<p>Во-вторых, необходимо протестировать изменение навигации и содержания страницы. Этот тест предполагает нажатие навигационной кнопки для изменения местоположения <code>$location</code>.</p>
<p>Поехали!</p>
<h3 id="Создаём-первые-тесты"><a href="#Создаём-первые-тесты" class="headerlink" title="Создаём первые тесты"></a>Создаём первые тесты</h3><p>Наш файл конфигурации Protractor довольно прост и почти не отличается от базового конфига, который поставляется при установке:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// пример файла конфигурации</span></div><div class="line">exports.config = &#123;</div><div class="line">  <span class="attr">seleniumAddress</span>: <span class="string">'http://0.0.0.0:4444/wd/hub'</span>,</div><div class="line">  <span class="attr">capabilities</span>: &#123; <span class="string">'browserName'</span>: <span class="string">'chrome'</span> &#125;,</div><div class="line">  <span class="attr">specs</span>: [<span class="string">'test/e2e/**/*.spec.js'</span>],</div><div class="line">  <span class="attr">jasmineNodeOpts</span>: &#123;</div><div class="line">    <span class="attr">showColors</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">defaultTimeoutInterval</span>: <span class="number">30000</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>Будем писать тесты в папке <code>test/e2e</code>, как и указали в конфигурационном файле в виде <code>[name].spec.js</code>. Создадим наш первый тест под названием <code>main.spec.js</code>.</p>
<p>Набросаем простую «рыбу»:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// в test/e2e/main.spec.js</span></div><div class="line">describe(<span class="string">'E2E: main page'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// здесь будут наши тесты</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Тк мы пишем тесты на фреймворке Jasmine, воспользуемся блоком <code>beforeEach()</code>. Также необходимо отслеживать экземпляр Protractor, создадим для этого переменную <code>ptor</code>. Для каждого теста будем использовать объект browser для перехода на главную страницу.</p>
<p>При сквозном тестировании,  нужен запущенный сервер, на котором будут осуществляться наши тесты.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">describe(<span class="string">'E2E: main page'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> ptor;</div><div class="line"></div><div class="line">  beforeEach(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    browser.get(<span class="string">'http://127.0.0.1:9000/'</span>);</div><div class="line">    ptor = protractor.getInstance();</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Вместо того, чтобы указывать полный URL каждый раз, когда хотим протестировать страницу, можем добавить параметр <code>baseUrl</code> в конфигурационный файл Protractor. Далее будем считать, что этот параметр в конфиге у нас выглядит так:</p>
<p><code>baseUrl: &#39;http://127.0.0.1:9000/&#39;,</code></p>
<p>Первый тест убедится, что главная страница загружается: проверим наличие элемента на странице. Поскольку на главной странице есть идентификатор  #home, создадим ожидание, проверяющее наше условие.</p>
<p>Сначала выберем <code>&lt;div&gt;</code> с идентификатором <code>#main</code> с помощью функции <code>by.id()</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">it(<span class="string">'should load the home page'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> ele = by.id(<span class="string">'home'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Получив нужный элемент, с помощью Protractor метода <code>isElementPresent()</code>: зададим ожидание, проверяющее присутствие элемента на странице:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">it(<span class="string">'should load the home page'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> ele = by.id(<span class="string">'home'</span>);</div><div class="line">  expect(ptor.isElementPresent(ele)).toBe(<span class="literal">true</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Для тестирования необходимо запустить сервер Selenium. К счастью, <code>webdriver-manager</code> облегчает нам жизнь (эта утилита автоматически включена в Protractor). Итак, запускаем  <code>webdriver-manager</code>:</p>
<p><code>$ ./node_modules/protractor/bin/webdriver-manager start</code></p>
<p>Запускаем Protractor в новом терминале. Двоичный файл <code>Protractor</code> принимает один аргумент — конфигурационный файл:</p>
<p><code>$ ./node_modules/protractor/bin/protractor protractor_conf.js</code></p>
<p><img src="/blog/images/protractor3.png" alt="Иллюстрация блокнота"></p>
<h3 id="Тестируем-поле-ввода"><a href="#Тестируем-поле-ввода" class="headerlink" title="Тестируем поле ввода"></a>Тестируем поле ввода</h3><p>Приступим к тестированию <code>&lt;input&gt;</code>.  Главная страница загружает одну форму с одним полем ввода, которое отображается, если пользователь сам не выбрал репозиторий для поиска issues. <code>input type=&quot;text&quot;</code> привязан к модели <code>repoName</code>. После заполнения, форма исчезает и появляется нужный список issues.</p>
<p><img src="/blog/images/protractor5.png" alt="Иллюстрация блокнота"></p>
<p>HTML выглядит так:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;div id=<span class="string">"repoform"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"main"</span> ng-<span class="keyword">if</span>=<span class="string">"!repoName"</span>&gt;</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">ng-submit</span>=<span class="string">"getIssues()"</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">'repo.name'</span> <span class="attr">placeholder</span>=<span class="string">'Enter repo name'</span> /&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"input-group-btn"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">value</span>=<span class="string">"Search"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Нам важно протестировать, что заполненная форма исчезает, и на её месте появляется нужный список issues. Поэтому в следующем тесте  выбираем элемент <code>&lt;input&gt;</code> и заполняем его, для этого применим к нему метод <code>sendKeys()</code>. Для выделения самого элемента <code>input</code> воспользуемся методом  <code>by.input()</code> , который найдёт элементы <code>&lt;input&gt;</code>, содержащие привязку к <code>ng-model</code>:</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> it(<span class="string">'the input box should go away on submit'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  element(by.input(<span class="string">'repo.name'</span>)).sendKeys(<span class="string">'angular/angular.js\n'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>При прогоне этого теста увидим, что  поле <code>&lt;input&gt;</code> заполняется. Никаких ожиданий нет, тк мы их ещё не написали, но видим, что в поле ввода появляется <code>angular/angular.js</code>.  </p>
<p>Чтобы поле ввода исчезло, нужно отправить заполненную форму. Наиболее просто это сделать, сымитировав нажатие клавиши enter. Поэтому в методе <code>sendKeys()</code> добавили сочетание <code>\n</code> , которое имитирует нажатие enter в элементе <code>&lt;input&gt;</code>.  </p>
<p>Теперь осталось написать ожидание, что элемент <code>repoForm</code> более не существует на странице (тк мы прячем его с помощью <code>ng-if</code>).</p>
<p>Используем для этого упомянутый ранее метод:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">it(<span class="string">'the input box should go away on submit'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  element(by.input(<span class="string">'repo.name'</span>)).sendKeys(<span class="string">'angular/angular.js\n'</span>);</div><div class="line">  expect(ptor.isElementPresent(by.id(<span class="string">'repoform'</span>))).toBe(<span class="literal">false</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>В части 2 мы протестируем список <code>&lt;issues&gt;</code> и навигацию. Держите руку на пульсе!</p>
  </section> <footer class='post-footer clearfix'>   <div class="addthis_toolbox addthis_default_style pull-right"> <a class="addthis_button_facebook"></a> <a class="addthis_button_twitter"></a> <a class="addthis_button_vk"></a> <a class="addthis_button_compact"></a> <a class="addthis_counter addthis_bubble_style"></a></div><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>  </footer> </div></article><section id="comment"> <h3 class="title">Комментарии</h3> <div id="disqus_thread"> <noscript>Включите Javascript, чтобы просмотреть <a href="//disqus.com/?ref_noscript">комментарии с помощью Disqus.</a></noscript> </div></section></div> <aside class="span2">  <div class="widget tag"> <h3 class="title">Тэги</h3> <ul class="unstyled">  <li> <span class='badge'>31</span> <a href="/blog/tags/AngularJS/"> AngularJS </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/CSS/"> CSS </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Chef/"> Chef </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Coffee-script/"> Coffee-script </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Cordova/"> Cordova </a> </li>  <li> <span class='badge'>5</span> <a href="/blog/tags/ElasticSearch/"> ElasticSearch </a> </li>  <li> <span class='badge'>5</span> <a href="/blog/tags/FAQ/"> FAQ </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/GitHub/"> GitHub </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/HTML5/"> HTML5 </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/ItProjects/"> ItProjects </a> </li>  <li> <span class='badge'>30</span> <a href="/blog/tags/Javascript/"> Javascript </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Mongoose/"> Mongoose </a> </li>  <li> <span class='badge'>11</span> <a href="/blog/tags/Node-js/"> Node.js </a> </li>  <li> <span class='badge'></span> <a href="/blog/tags/NodeJS/"> NodeJS </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Objective-C/"> Objective-C </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/PhoneGap/"> PhoneGap </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/RabbitMQ/"> RabbitMQ </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/SEO/"> SEO </a> </li>  <li> <span class='badge'>3</span> <a href="/blog/tags/SQL/"> SQL </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/YAC2014/"> YAC2014 </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/bash/"> bash </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/iOS7/"> iOS7 </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/jQuery/"> jQuery </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Бизнес-модель/"> Бизнес модель </a> </li>  <li> <span class='badge'>4</span> <a href="/blog/tags/Для-новичков/"> Для новичков </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Жизнь-компании/"> Жизнь компании </a> </li>  </ul></div></aside> </div></section> <!-- /container --><footer id='contacts' class='footer-main'> <div class='callback'> <div class='container'> <div class='row'> <div class='span12'> <h2 class='xlarge'>Есть вопросы или предложения?</h2> <p class='outlined-caption'>закажите обратный звонок и наш менеджер перезвонит вам</p> <form method='POST' action='/brief' id='callback'> <ul class='hidden error'></ul> <input type="text" name='name' placeholder="Как к вам обратиться?" class='span12' required /> <input type="text" name='phone' placeholder="По какому номеру звонить?" class='span6' /> <input type="email" name='email' placeholder="E-mail (опционально)" class='span6 pull-right' /> <textarea name='question' placeholder="Ваш вопрос (опционально)" class='span12'></textarea> <button type="submit" class='blue-plank'>Заказать звонок</button> </form> </div> </div> </div> </div> <div class='container'> <div class='row'> <div class='span6'> <h4 class='footer-caption'>Разделы сайта</h4> <ul class="nav inline">  <li><a href="/blog">Блог</a></li>  <li><a href="/team">Команда</a></li>  <li><a href="#about">О нас</a></li>  <li><a href="#portfolio">Портфолио</a></li>  <li><a href="#tech">Технологии</a></li>  <li><a href="#contacts">Контакты</a></li>  <li><a href='https://github.com/AVVSDevelopment/avvs.co'>Проект на GitHub</a></li> </ul> <p class='copyright'>Makeomatic, (c) 2012-2016<br/>Разработка сайтов и мобильных приложений</p> </div> <div class='span6 blue-line'> <h4 class='footer-caption'>Контакты</h4> <p> тел: +7 (495) 79-222-44 </p> <p> e-mail: <a href="mailto:getstarted@makeomatic.ru">getstarted@makeomatic.ru</a> </p> <address> Россия, Москва, Ленинский пр-т, дом 30а<br/>индекс: 111555 </address> <div class="social"> <a class="fcb fa-stack fa-lg" href="https://www.facebook.com/makeomatic"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-facebook fa-stack-1x fa-inverse"></i> </a> <a class="fa-stack fa-lg" href="http://vk.com/makeomatic"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-vk fa-stack-1x fa-inverse"></i> </a> <a class="twt fa-stack fa-lg" href="https://twitter.com/MakeOmatic"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i> </a> <a class="gp fa-stack fa-lg" href="https://google.com/+MakeomaticRu"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-google-plus fa-stack-1x fa-inverse"></i> </a> </div> </div> </div> </div></footer><div class="modal hide fade brief" id='brief'> <div class="modal-body"> <div class='text-center'> <h2 class='brief-header outlined-caption'>Расскажите нам о вашем проекте</h2> <p class='small'> Коротко опишите ваши идеи или просто прикрепите файл с готовым ТЗ.<br/> Мы свяжемся с вами в течение 1 дня и подробно расскажем о том, как мы можем вам помочь. </p> </div> <form method='POST' action='/brief' class='callback'> <input type="text" name='name' placeholder="Как к вам обратиться?" class='span10' required /> <input type="text" name='phone' placeholder="По какому номеру звонить?" class='span5' /> <input type="email" name='email' placeholder="E-mail (опционально)" class='span5 pull-right' /> <textarea name='question' placeholder="Краткое описание вашего проекта" class='span7'></textarea> <div class='dropbox pull-right' id='dropbox' ></div> <button class="blue-plank pull-right" type='submit'>Отправить</button> </form> </div></div><!-- scripts --><script src="/js/app.min.2.3.1.js" charset="UTF-8" ></script><!-- end scripts --><script type="text/javascript">var disqus_shortname = 'makeomatic';(function(){ var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);}());</script><!-- Yandex.Metrika counter --><script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter15629977 = new Ya.Metrika({id:15629977, webvisor:true, clickmap:true, trackLinks:true, accurateTrackBounce:true, trackHash:true, ut:"noindex"}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="//mc.yandex.ru/watch/15629977?ut=noindex" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter --><!-- google analytics --><script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-40638966-1', 'makeomatic.ru'); ga('send', 'pageview');</script></body></html>