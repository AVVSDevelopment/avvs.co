<!DOCTYPE html><!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="ru"> <![endif]--><!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang="ru"> <![endif]--><!--[if IE 8]>         <html class="no-js lt-ie9" lang="ru"> <![endif]--><!--[if gt IE 8]><!--> <html class="no-js" lang="ru"> <!--<![endif]--><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#"> <meta charset="utf-8">  <title>Замена конструкции switch на объектные литералы | Блог Makeomatic: разработка сайтов и мобильных приложений</title> <meta name="author" content="Makeomatic">  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"> <!-- For third-generation iPad with high-resolution Retina display: --> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144x144-precomposed.png"> <!-- For iPhone with high-resolution Retina display running iOS ≥ 7: --> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/apple-touch-icon-120x120-precomposed.png"> <!-- For iPhone with high-resolution Retina display running iOS ≤ 6: --> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/apple-touch-icon-114x114-precomposed.png"> <!-- For first- and second-generation iPad: --> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/apple-touch-icon-72x72-precomposed.png"> <!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: --> <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"> <meta name="description" content="Во многих языках программирования есть конструкция switch – но стоит ли её применять?
Если вы JS-программист, вы постоянно работаете с объектами: создаёте, инициализируете и совершаете с ними разные м">
<meta property="og:type" content="article">
<meta property="og:title" content="Замена конструкции switch на объектные литералы">
<meta property="og:url" content="https://makeomatic.ru/blog/2014/12/17/Switch_statement/index.html">
<meta property="og:site_name" content="Блог Makeomatic: разработка сайтов и мобильных приложений">
<meta property="og:description" content="Во многих языках программирования есть конструкция switch – но стоит ли её применять?
Если вы JS-программист, вы постоянно работаете с объектами: создаёте, инициализируете и совершаете с ними разные м">
<meta property="og:image" content="https://makeomatic.ru/blog/images/switch.jpg">
<meta property="og:updated_time" content="2015-01-16T20:34:23.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Замена конструкции switch на объектные литералы">
<meta name="twitter:description" content="Во многих языках программирования есть конструкция switch – но стоит ли её применять?
Если вы JS-программист, вы постоянно работаете с объектами: создаёте, инициализируете и совершаете с ними разные м">
<meta name="twitter:creator" content="@makeomatic">
<link rel="publisher" href="https://plus.google.com/+MakeomaticRu">  <link rel="alternate" hreflang="ru" href="https:&#47;&#47;makeomatic.ru&#47;blog&#47;2014&#47;12&#47;17&#47;Switch_statement&#47;" />   <meta property="og:image:width" content="623" /> <meta property="og:image:height" content="436" />  <link href='//fonts.googleapis.com/css?family=Roboto:300,700&subset=latin,cyrillic,cyrillic-ext' rel='stylesheet' type='text/css'>  <link rel="stylesheet" href="/css/app.min.2.1.0.css">  <script src="/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script> <!-- place this in your head tag --> <!-- <script src='https://js.tito.io/v1' async></script> --> <!-- <link rel="stylesheet" type="text/css" href='https://css.tito.io/v1' /> --></head><body data-spy="scroll" data-target=".navbar" data-offset="150"><!--[if lt IE 8]><p class="chromeframe">Вы используете <strong>устаревший</strong> браузер. Пожалуйста <a href="http://browsehappy.com/">обновите ваш браузер</a> или <a href="http://www.google.com/chromeframe/?redirect=true">активируйте Google Chrome Frame</a>, чтобы улучшить ваши впечатления от посещения сайта.</p><![endif]--><header class="navbar navbar-inverse navbar-fixed-top"> <div class="navbar-inner"> <div class="container"> <div class="social-desktop"> <a class="fcb" href="https://www.facebook.com/makeomatic"> <i class="fa fa-facebook"></i> </a> <a class="vk" href="https://vk.com/makeomatic"> <i class="fa fa-vk"></i> </a> <a class="twt" href="https://twitter.com/MakeOmatic"> <i class="fa fa-twitter"></i> </a> <a class="gp" href="https://google.com/+MakeomaticRu"> <i class="fa fa-google-plus-square"></i> </a> </div> <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a> <a class="brand" href="/">makeomatic</a> <div class="nav-collapse collapse"> <ul class="nav">   <li class='active '> <a href="/blog" > Блог  </a>  </li>   <li class=' dropdown'> <a href="/team" data-target="#" class="dropdown-toggle" data-toggle="dropdown"> Команда  <b class='caret'></b>  </a>  <ul class='dropdown-menu'>   <li> <a href="/team#vyacheslavgusev">Вячеслав Гусев</a> </li>   <li> <a href="/team#vitaliiaminev">Виталий Аминев</a> </li>   <li> <a href="/team#annaamineva">Анна Аминева</a> </li>   <li> <a href="/team#andreiafoninskii">Андрей Афонинский</a> </li>   <li> <a href="/team#aleksandrkremenets">Александр Кременец</a> </li>   <li> <a href="/team#dmitriigorbunov">Дмитрий Горбунов</a> </li>   <li> <a href="/team#evgeniipoyarkov">Евгений Поярков</a> </li>   <li> <a href="/team#ilyaovsyannikov">Илья Овсянников</a> </li>  </ul>  </li>   <li class=' '> <a href="/#about" > О нас  </a>  </li>   <li class=' dropdown'> <a href="/#portfolio" data-target="#" class="dropdown-toggle" data-toggle="dropdown"> Портфолио  <b class='caret'></b>  </a>  <ul class='dropdown-menu'>   <li> <a href="/#Distribut.io">Distribut.io</a> </li>   <li> <a href="/#Recordi">Recordi</a> </li>   <li> <a href="/#Photobot">Photobot</a> </li>   <li> <a href="/#BrainsApp">BrainsApp</a> </li>   <li> <a href="/#FabrikaTepla">FabrikaTepla</a> </li>   <li> <a href="/#SpeakGeo">SpeakGeo</a> </li>   <li> <a href="/#OpenInclude">OpenInclude</a> </li>   <li> <a href="/#LIVEONE">LIVEONE</a> </li>   <li> <a href="/#FitCafe">FitCafe</a> </li>  </ul>  </li>   <li class=' '> <a href="/#tech" > Технологии  </a>  </li>   <li class=' '> <a href="#contacts" > Контакты  </a>  </li>  </ul> </div><!--/.nav-collapse --> <div class='send-brief' > <a href='#brief' role='button' data-toggle='modal'> <i class='background'></i> <span>Заполнить бриф</span> </a> </div> <h4 class='phone-desktop'> Звоните: +7 (495) 79-222-44 </h4> </div> </div></header><div class="icon-up visible-desktop" id="up" title="наверх"></div><section class="container blog" id='blog'> <h1 class='outlined-caption text-center'> <a href='/blog'>Блог Makeomatic: разработка сайтов и мобильных приложений</a> </h1>  <div class='row'> <div class='span10'><article class="post"> <div class="post-content"> <header class='post-header'>   <h2 class="title">Замена конструкции switch на объектные литералы</h2> <p class='muted'></p>   <div class="icon"></div> <time datetime="2014-12-17T08:00:00.000Z"> Dec 17 2014 </time>   <div class="tags"> | Категории: <a href="/blog/tags/AngularJS/">AngularJS</a>, <a href="/blog/tags/Javascript/">Javascript</a> </div> <span class='author'><img src='//www.gravatar.com/avatar/533bf2bc5b98773298fa3715a5e286ee?s=20' /> Eleonora Pavlova</span>  </header> <section class="body">  <p><img src="/blog/images/switch.jpg" alt="Иллюстрация блокнота"><br>Во многих языках программирования есть конструкция <code>switch</code> – но стоит ли её применять?</p>
<p>Если вы JS-программист, вы постоянно работаете с объектами: создаёте, инициализируете и совершаете с ними разные манипуляции. Объекты очень гибкие — в javascript практически всё на них построено, и именно их я в последнее время использую вместо <code>switch</code>.<br><a id="more"></a></p>
<h3 id="Что_такое_конструкция_switch?">Что такое конструкция switch?</h3><p>Если вы ранее не использовали <code>switch</code> или не очень понимаете, что данная конструкция делает, давайте разберёмся. <code>Switch</code> последовательно сравнивает выражение со всеми указанными константами и выводит найденное соответствие, например, исполняемый блок кода.</p>
<p>Взглянем на типичное использование <code>switch</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> type = <span class="string">'coke'</span>;</span><br><span class="line"><span class="keyword">var</span> drink;</span><br><span class="line"><span class="keyword">switch</span>(type) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'coke'</span>:</span><br><span class="line">  drink = <span class="string">'Coke'</span>;</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'pepsi'</span>:</span><br><span class="line">  drink = <span class="string">'Pepsi'</span>;</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">  drink = <span class="string">'Unknown drink!'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(drink); <span class="comment">// 'Coke'</span></span><br></pre></td></tr></table></figure>
<p>Напоминает условную конструкцию <code>else</code> и <code>if</code>, но <code>switch</code> сравнивает с одним значением в каждом случае <code>case</code> нашей конструкции.<br>Когда в коде много условий <code>else if</code>, вероятно, что-то не так – в подобных случаях целесообразнее использовать <code>switch</code>. Вот пример злоупотребления <code>else if</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">getDrink</span> (<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (type === <span class="string">'coke'</span>) &#123;</span><br><span class="line">    type = <span class="string">'Coke'</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'pepsi'</span>) &#123;</span><br><span class="line">    type = <span class="string">'Pepsi'</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'mountain dew'</span>) &#123;</span><br><span class="line">    type = <span class="string">'Mountain Dew'</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'lemonade'</span>) &#123;</span><br><span class="line">    type = <span class="string">'Lemonade'</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'fanta'</span>) &#123;</span><br><span class="line">    type = <span class="string">'Fanta'</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// выступает в качестве «дефолтного» значения</span></span><br><span class="line">    type = <span class="string">'Unknown drink!'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'You\'ve picked a '</span> + type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Данный вариант — слишком общий, допускает ошибки и крайне многословен (повторы). Он допускает и всякие хаки, тк можно сравнивать несколько значений в каждом <code>else if</code>, например: <code>else if (type === &#39;coke&#39; &amp;&amp; somethingElse !== &#39;apples&#39;)</code>. В таких ситуациях <code>switch</code> был идеальным решением, хотя и приходилось не забывать добавлять оператор <code>break</code>; в конце каждого случая case для предотвращения автоматического исполнения кода следующего case (частая ошибка switch).  </p>
<h3 id="Проблемы_switch">Проблемы switch</h3><p>В использовании <code>switch</code> есть много неприятных моментов: процедурный поток управления, нестандартный синтактис блоков кода — в javascript стандартно используются фигурные скобки,  в конструкции <code>switch</code> – нет. В целом, синтаксис <code>switch</code> – не лучший пример javascript. Мы вынуждены вручную добавлять break для каждого case, что может усложнить дальнейшую отладку ошибок, а если где-то забудем break, это спровоцирует ошибки в последующих случаях case. Дуглас Крокфорд не раз об этом писал и рассказывал, он рекомендует использовать <code>switch</code> с осторожностью.</p>
<p>В javascript мы часто обращаемся к объектам для решения всевозможных задач, включая те, для которых нам бы и в голову не пришло использовать <code>switch</code>. Так почему бы не использовать объектный литерал вместо <code>switch</code>? Это сделает наш код более гибким, читаемым, поддерживаемым, и не нужно будет вручную добавлять к кейсам break! Также это упрощает работу новичкам, поскольку это стандартные объекты.</p>
<p>По мере увеличения количества case производительность объектов (хэш-таблиц) становится лучше, чем у конструкции <code>switch</code> (где важна последовательность кэйсов). Объектный подход это поиск по хеш-таблицам, а конструкция <code>switch</code> должна оценивать каждый case, пока не найдёт соответствие и <code>break</code>.</p>
<h3 id="Поиск_по_объектным_литералам">Поиск по объектным литералам</h3><p>Мы постоянно используем объекты как конструкторы или литералы, часто для операций поиска — получения значений свойств объекта.<br>Создадим простой объект, который возвращает только строковое значение:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDrink</span> (<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> drinks = &#123;</span><br><span class="line">    <span class="string">'coke'</span>: <span class="string">'Coke'</span>,</span><br><span class="line">    <span class="string">'pepsi'</span>: <span class="string">'Pepsi'</span>,</span><br><span class="line">    <span class="string">'lemonade'</span>: <span class="string">'Lemonade'</span>,</span><br><span class="line">    <span class="string">'default'</span>: <span class="string">'Default item'</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'The drink I chose was '</span> + (drinks[type] || drinks[<span class="string">'default'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> drink = getDrink(<span class="string">'coke'</span>);</span><br><span class="line"><span class="comment">// The drink I chose was Coke</span></span><br><span class="line"><span class="built_in">console</span>.log(drink);</span><br></pre></td></tr></table></figure>
<p>Наш код на пару строк короче, чем пример со <code>switch</code>, и, мне кажется, лучше читается. Упростим его, убрав дефолтное значение:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDrink</span> (<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'The drink I chose was '</span> + &#123;</span><br><span class="line">    <span class="string">'coke'</span>: <span class="string">'Coke'</span>,</span><br><span class="line">    <span class="string">'pepsi'</span>: <span class="string">'Pepsi'</span>,</span><br><span class="line">    <span class="string">'lemonade'</span>: <span class="string">'Lemonade'</span></span><br><span class="line">  &#125;[type];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Однако, нам может понадобиться более сложное значение, чем строка, способное храниться в функции. Для краткости и простоты, я верну эти же строки в только что созданные функции:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> type = <span class="string">'coke'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> drinks = &#123;</span><br><span class="line">  <span class="string">'coke'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Coke'</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">'pepsi'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Pepsi'</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">'lemonade'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Lemonade'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Разница в том, что нам нужно вызвать функцию объекта:<br><code>drinks[type]();</code></p>
<p>Такой код - легче поддерживать, приятнее читать. Простой объект. Можно забыть про <code>break</code> и ошибки, связанные с его отсутствием в конце case.</p>
<p>В случае со <code>switch</code> мы бы поместили его в функцию и <code>return</code> значение, сделаем то же самое с объектом, превратив его в практичную функцию:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDrink</span> (<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> drinks = &#123;</span><br><span class="line">    <span class="string">'coke'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'Coke'</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'pepsi'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'Pepsi'</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'lemonade'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'Lemonade'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> drinks[type]();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// вызовем функцию</span></span><br><span class="line"><span class="keyword">var</span> drink = getDrink(<span class="string">'coke'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(drink); <span class="comment">// 'Coke'</span></span><br></pre></td></tr></table></figure>
<p>Всё отлично, но не учтён дефолтный случай. Это легко исправить:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDrink</span> (<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> fn;</span><br><span class="line">  <span class="keyword">var</span> drinks = &#123;</span><br><span class="line">    <span class="string">'coke'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'Coke'</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'pepsi'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'Pepsi'</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'lemonade'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'Lemonade'</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'default'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'Default item'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// если объект drinks содержит переданный параметр,</span></span><br><span class="line">  <span class="comment">// используем его</span></span><br><span class="line">  <span class="keyword">if</span> (drinks[type]) &#123;</span><br><span class="line">    fn = drinks[type];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// в ином случае, приравняем к дефолтному значению drinks.default</span></span><br><span class="line">    <span class="comment">// удобно и логично использовать везде квадратные скобки</span></span><br><span class="line">    fn = drinks[<span class="string">'default'</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> fn();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// вызываем с параметром "dr pepper"</span></span><br><span class="line"><span class="keyword">var</span> drink = getDrink(<span class="string">'dr pepper'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(drink); <span class="comment">// 'выдаст дефолтное значение'</span></span><br></pre></td></tr></table></figure>
<p>Можно упростить нашу конструкцию <code>else</code> и <code>if</code>, используя в выражении оператор <code>||</code> «или»:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDrink</span> (<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> drinks = &#123;</span><br><span class="line">    <span class="string">'coke'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'Coke'</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'pepsi'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'Pepsi'</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'lemonade'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'Lemonade'</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'default'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'Default item'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (drinks[type] || drinks[<span class="string">'default'</span>])();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Мы поставили операции поиска по объекту <code>()</code>, что делает их выражением. И затем вызвали результат выражения. Если <code>drinks [type]</code> не будет найден, вернётся <code>drinks[&#39;default&#39;]</code> — элементарно!</p>
<p>Не обязательно всегда делать <code>return</code> внутри функции, можем присвоить результат любой переменной и затем вызвать её.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDrink</span> (<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> drink;</span><br><span class="line">  <span class="keyword">var</span> drinks = &#123;</span><br><span class="line">    <span class="string">'coke'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      drink = <span class="string">'Coke'</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'pepsi'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      drink = <span class="string">'Pepsi'</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'lemonade'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      drink = <span class="string">'Lemonade'</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'default'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      drink = <span class="string">'Default item'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">    <span class="comment">// вызываем выражение</span></span><br><span class="line">  (drinks[type] || drinks[<span class="string">'default'</span>])();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// возвращаем строку с выбранным напитком drink</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">'The drink I chose was '</span> + drink;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> drink = getDrink(<span class="string">'coke'</span>);</span><br><span class="line"><span class="comment">// The drink I chose was Coke</span></span><br><span class="line"><span class="built_in">console</span>.log(drink);</span><br></pre></td></tr></table></figure>
<ul>
<li>Это самые базовые примеры;</li>
<li>Объектные литералы содержат функцию, которая возвращает строку;</li>
</ul>
<p>Если вам нужна только строка, вы можете использовать строку как значение ключа — но иногда всё же логичнее использовать функции. Если вы используете и строки и функции, возможно, будет проще всегда использовать функции — для безопасного поиска параметра и дальнейшего вызова — мы ведь не хотим пытаться вызывать строку.</p>
<h3 id="“Проскакивание”_объектов">“Проскакивание” объектов</h3><p>В случае со <code>switch</code> мы можем позволить кейсу «проскочить» — когда к одному блоку кода применяется более одного случая case.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> type = <span class="string">'coke'</span>;</span><br><span class="line"><span class="keyword">var</span> snack;</span><br><span class="line"><span class="keyword">switch</span>(type) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'coke'</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">'pepsi'</span>:</span><br><span class="line">  snack = <span class="string">'Drink'</span>;</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'cookies'</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">'crisps'</span>:</span><br><span class="line">  snack = <span class="string">'Food'</span>;</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">  drink = <span class="string">'Unknown type!'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(snack); <span class="comment">// 'Drink'</span></span><br></pre></td></tr></table></figure>
<p>Мы позволяем <code>coke</code> и <code>pepsi</code> «проскочить» и не завершаем цикл <code>switch</code>, поскольку не добавляем оператор <code>break</code>. То же самое легко и более наглядно можно сделать с объектными литералами — это сделает наш код структурированным, читаемым и многократно используемым, а также убережёт от ошибкам.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSnack</span> (<span class="params">type</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> snack;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isDrink</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> snack = <span class="string">'Drink'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isFood</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> snack = <span class="string">'Food'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> snacks = &#123;</span><br><span class="line">    <span class="string">'coke'</span>: isDrink,</span><br><span class="line">    <span class="string">'pepsi'</span>: isDrink,</span><br><span class="line">    <span class="string">'cookies'</span>: isFood,</span><br><span class="line">    <span class="string">'crisps'</span>: isFood,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> snacks[type]();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> snack = getSnack(<span class="string">'coke'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(snack); <span class="comment">// 'Drink'</span></span><br></pre></td></tr></table></figure>
<p>####Выводы</p>
<p>Применение объектов даёт больший контроль над кодом, конструкция <code>switch</code> –  немного устарела, не изящна в синтаксисе и сложна в отладке ошибок. Объекты проще расширять, поддерживать и тестировать. Они привычны, поскольку являются основополагающим звеном Javascript, и мы используем их в работе каждый день для самых разных задач. Объектные литералы могут содержать функции и любые другие <a href="http://toddmotto.com/understanding-javascript-types-and-reliable-type-checking/" target="_blank" rel="external">типы объектов</a>, что делает их очень гибкими. У функций в литералах есть область действия (scope), поэтому мы можем вернуть замыкание из вызываемой родительской функции (в нашем случае <code>getDrink</code> возвращает замыкание).</p>
<p>Комментарии и фидбэк можно найти на <a href="http://www.reddit.com/r/javascript/comments/2b4s6r/deprecating_the_switch_statement_for_object" target="_blank" rel="external">Reddit</a>  </p>
<p>По мотивам <a href="http://toddmotto.com/deprecating-the-switch-statement-for-object-literals/" target="_blank" rel="external">Todd Motto</a></p>
  </section> <footer class='post-footer clearfix'>   <div class="addthis_toolbox addthis_default_style pull-right"> <a class="addthis_button_facebook"></a> <a class="addthis_button_twitter"></a> <a class="addthis_button_vk"></a> <a class="addthis_button_compact"></a> <a class="addthis_counter addthis_bubble_style"></a></div><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>  </footer> </div></article><section id="comment"> <h3 class="title">Комментарии</h3> <div id="disqus_thread"> <noscript>Включите Javascript, чтобы просмотреть <a href="//disqus.com/?ref_noscript">комментарии с помощью Disqus.</a></noscript> </div></section></div> <aside class="span2">  <div class="widget tag"> <h3 class="title">Тэги</h3> <ul class="unstyled">  <li> <span class='badge'>31</span> <a href="/blog/tags/AngularJS/"> AngularJS </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/CSS/"> CSS </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Chef/"> Chef </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Coffee-script/"> Coffee-script </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Cordova/"> Cordova </a> </li>  <li> <span class='badge'>5</span> <a href="/blog/tags/ElasticSearch/"> ElasticSearch </a> </li>  <li> <span class='badge'>5</span> <a href="/blog/tags/FAQ/"> FAQ </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/GitHub/"> GitHub </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/HTML5/"> HTML5 </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/ItProjects/"> ItProjects </a> </li>  <li> <span class='badge'>29</span> <a href="/blog/tags/Javascript/"> Javascript </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Mongoose/"> Mongoose </a> </li>  <li> <span class='badge'>9</span> <a href="/blog/tags/Node-js/"> Node.js </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/NodeJS/"> NodeJS </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Objective-C/"> Objective-C </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/PhoneGap/"> PhoneGap </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/RabbitMQ/"> RabbitMQ </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/SEO/"> SEO </a> </li>  <li> <span class='badge'>3</span> <a href="/blog/tags/SQL/"> SQL </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/YAC2014/"> YAC2014 </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/bash/"> bash </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/iOS7/"> iOS7 </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/jQuery/"> jQuery </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Бизнес-модель/"> Бизнес модель </a> </li>  <li> <span class='badge'>4</span> <a href="/blog/tags/Для-новичков/"> Для новичков </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Жизнь-компании/"> Жизнь компании </a> </li>  </ul></div></aside> </div></section> <!-- /container --><footer id='contacts' class='footer-main'> <div class='callback'> <div class='container'> <div class='row'> <div class='span12'> <h2 class='xlarge'>Есть вопросы или предложения?</h2> <p class='outlined-caption'>закажите обратный звонок и наш менеджер перезвонит вам</p> <form method='POST' action='/brief' id='callback'> <ul class='hidden error'></ul> <input type="text" name='name' placeholder="Как к вам обратиться?" class='span12' required /> <input type="text" name='phone' placeholder="По какому номеру звонить?" class='span6' /> <input type="email" name='email' placeholder="E-mail (опционально)" class='span6 pull-right' /> <textarea name='question' placeholder="Ваш вопрос (опционально)" class='span12'></textarea> <button type="submit" class='blue-plank'>Заказать звонок</button> </form> </div> </div> </div> </div> <div class='container'> <div class='row'> <div class='span6'> <h4 class='footer-caption'>Разделы сайта</h4> <ul class="nav inline">  <li><a href="/blog">Блог</a></li>  <li><a href="/team">Команда</a></li>  <li><a href="#about">О нас</a></li>  <li><a href="#portfolio">Портфолио</a></li>  <li><a href="#tech">Технологии</a></li>  <li><a href="#contacts">Контакты</a></li>  <li><a href='https://github.com/AVVSDevelopment/avvs.co'>Проект на GitHub</a></li> </ul> <p class='copyright'>Makeomatic, (c) 2012-2014<br/>Разработка сайтов и мобильных приложений</p> </div> <div class='span6 blue-line'> <h4 class='footer-caption'>Контакты</h4> <p> тел: +7 (495) 79-222-44 </p> <p> e-mail: <a href="mailto:getstarted@makeomatic.ru">getstarted@makeomatic.ru</a> </p> <address> Россия, Москва, Ленинский пр-т, дом 30а<br/>индекс: 111555 </address> <div class="social"> <a class="fcb fa-stack fa-lg" href="https://www.facebook.com/makeomatic"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-facebook fa-stack-1x fa-inverse"></i> </a> <a class="fa-stack fa-lg" href="http://vk.com/makeomatic"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-vk fa-stack-1x fa-inverse"></i> </a> <a class="twt fa-stack fa-lg" href="https://twitter.com/MakeOmatic"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i> </a> <a class="gp fa-stack fa-lg" href="https://google.com/+MakeomaticRu"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-google-plus fa-stack-1x fa-inverse"></i> </a> </div> </div> </div> </div></footer><div class="modal hide fade brief" id='brief'> <div class="modal-body"> <div class='text-center'> <h2 class='brief-header outlined-caption'>Расскажите нам о вашем проекте</h2> <p class='small'> Коротко опишите ваши идеи или просто прикрепите файл с готовым ТЗ.<br/> Мы свяжемся с вами в течение 1 дня и подробно расскажем о том, как мы можем вам помочь. </p> </div> <form method='POST' action='/brief' class='callback'> <input type="text" name='name' placeholder="Как к вам обратиться?" class='span10' required /> <input type="text" name='phone' placeholder="По какому номеру звонить?" class='span5' /> <input type="email" name='email' placeholder="E-mail (опционально)" class='span5 pull-right' /> <textarea name='question' placeholder="Краткое описание вашего проекта" class='span7'></textarea> <div class='dropbox pull-right' id='dropbox' ></div> <button class="blue-plank pull-right" type='submit'>Отправить</button> </form> </div></div><!-- scripts --><script src="/js/app.min.2.1.0.js" charset="UTF-8" ></script><!-- end scripts --><script type="text/javascript">var disqus_shortname = 'makeomatic';(function(){ var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);}());</script><!-- Yandex.Metrika counter --><script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter15629977 = new Ya.Metrika({id:15629977, webvisor:true, clickmap:true, trackLinks:true, accurateTrackBounce:true, trackHash:true, ut:"noindex"}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="//mc.yandex.ru/watch/15629977?ut=noindex" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter --><!-- google analytics --><script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-40638966-1', 'makeomatic.ru'); ga('send', 'pageview');</script></body></html>