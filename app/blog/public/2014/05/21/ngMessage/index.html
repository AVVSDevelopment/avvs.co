<!DOCTYPE html><!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="ru"> <![endif]--><!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang="ru"> <![endif]--><!--[if IE 8]>         <html class="no-js lt-ie9" lang="ru"> <![endif]--><!--[if gt IE 8]><!--> <html class="no-js" lang="ru"> <!--<![endif]--><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#"> <meta charset="utf-8">  <title>Как использовать ngMessages в AngularJS | Блог Makeomatic: разработка сайтов и мобильных приложений</title> <meta name="author" content="Makeomatic">  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"> <!-- For third-generation iPad with high-resolution Retina display: --> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144x144-precomposed.png"> <!-- For iPhone with high-resolution Retina display running iOS ≥ 7: --> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/apple-touch-icon-120x120-precomposed.png"> <!-- For iPhone with high-resolution Retina display running iOS ≤ 6: --> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/apple-touch-icon-114x114-precomposed.png"> <!-- For first- and second-generation iPad: --> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/apple-touch-icon-72x72-precomposed.png"> <!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: --> <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"> <meta name="description" content="##Что за ngMessage? ngMessages - новая возможность в AngularJS 1.3 для отображения сообщений об ошибках в формах. Работа с формами в Ангуляре является сказкой, так как она основана на взаимодействии">
<meta name="keywords" content="Javascript,AngularJS">
<meta property="og:type" content="article">
<meta property="og:title" content="Как использовать ngMessages в AngularJS">
<meta property="og:url" content="https://makeomatic.ru/blog/2014/05/21/ngMessage/index.html">
<meta property="og:site_name" content="Блог Makeomatic: разработка сайтов и мобильных приложений">
<meta property="og:description" content="##Что за ngMessage? ngMessages - новая возможность в AngularJS 1.3 для отображения сообщений об ошибках в формах. Работа с формами в Ангуляре является сказкой, так как она основана на взаимодействии">
<meta property="og:image" content="https://makeomatic.ru/blog/images/ngmassage.jpg">
<meta property="og:updated_time" content="2016-01-08T17:55:51.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Как использовать ngMessages в AngularJS">
<meta name="twitter:description" content="##Что за ngMessage? ngMessages - новая возможность в AngularJS 1.3 для отображения сообщений об ошибках в формах. Работа с формами в Ангуляре является сказкой, так как она основана на взаимодействии">
<meta name="twitter:image" content="https://makeomatic.ru/blog/images/ngmassage.jpg">
<meta name="twitter:creator" content="@makeomatic">
<link rel="publisher" href="https://plus.google.com/+MakeomaticRu">  <link rel="alternate" hreflang="ru" href="hhttps:&#47;&#47;makeomatic.ru&#47;blog&#47;2014&#47;05&#47;21&#47;ngMessage&#47;" />   <meta property="og:image:width" content="395" /> <meta property="og:image:height" content="304" />  <link href='//fonts.googleapis.com/css?family=Roboto:300,700&subset=latin,cyrillic,cyrillic-ext' rel='stylesheet' type='text/css'>  <link rel="stylesheet" href="/css/app.min.2.3.1.css">  <script src="/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script> <!-- place this in your head tag --> <!-- <script src='https://js.tito.io/v1' async></script> --> <!-- <link rel="stylesheet" type="text/css" href='https://css.tito.io/v1' /> --></head><body data-spy="scroll" data-target=".navbar" data-offset="150"><!--[if lt IE 8]><p class="chromeframe">Вы используете <strong>устаревший</strong> браузер. Пожалуйста <a href="http://browsehappy.com/">обновите ваш браузер</a> или <a href="http://www.google.com/chromeframe/?redirect=true">активируйте Google Chrome Frame</a>, чтобы улучшить ваши впечатления от посещения сайта.</p><![endif]--><header class="navbar navbar-inverse navbar-fixed-top"> <div class="navbar-inner"> <div class="container"> <div class="social-desktop"> <a class="fcb" href="https://www.facebook.com/makeomatic"> <i class="fa fa-facebook"></i> </a> <a class="vk" href="https://vk.com/makeomatic"> <i class="fa fa-vk"></i> </a> <a class="twt" href="https://twitter.com/MakeOmatic"> <i class="fa fa-twitter"></i> </a> <a class="gp" href="https://google.com/+MakeomaticRu"> <i class="fa fa-google-plus-square"></i> </a> </div> <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a> <a class="brand" href="/">makeomatic</a> <div class="nav-collapse collapse"> <ul class="nav">   <li class='active '> <a href="/blog" > Блог  </a>  </li>   <li class=' dropdown'> <a href="/team" data-target="#" class="dropdown-toggle" data-toggle="dropdown"> Команда  <b class='caret'></b>  </a>  <ul class='dropdown-menu'>   <li> <a href="/team#vyacheslavgusev">Вячеслав Гусев</a> </li>   <li> <a href="/team#vitaliiaminev">Виталий Аминев</a> </li>   <li> <a href="/team#annaamineva">Анна Аминева</a> </li>   <li> <a href="/team#andreiafoninskii">Андрей Афонинский</a> </li>   <li> <a href="/team#aleksandrkremenets">Александр Кременец</a> </li>   <li> <a href="/team#dmitriigorbunov">Дмитрий Горбунов</a> </li>   <li> <a href="/team#evgeniipoyarkov">Евгений Поярков</a> </li>   <li> <a href="/team#ilyaovsyannikov">Илья Овсянников</a> </li>  </ul>  </li>   <li class=' '> <a href="/#about" > О нас  </a>  </li>   <li class=' dropdown'> <a href="/#portfolio" data-target="#" class="dropdown-toggle" data-toggle="dropdown"> Портфолио  <b class='caret'></b>  </a>  <ul class='dropdown-menu'>   <li> <a href="/#Distribut.io">Distribut.io</a> </li>   <li> <a href="/#Recordi">Recordi</a> </li>   <li> <a href="/#Photobot">Photobot</a> </li>   <li> <a href="/#BrainsApp">BrainsApp</a> </li>   <li> <a href="/#FabrikaTepla">FabrikaTepla</a> </li>   <li> <a href="/#SpeakGeo">SpeakGeo</a> </li>   <li> <a href="/#OpenInclude">OpenInclude</a> </li>   <li> <a href="/#LIVEONE">LIVEONE</a> </li>   <li> <a href="/#FitCafe">FitCafe</a> </li>  </ul>  </li>   <li class=' '> <a href="/#tech" > Технологии  </a>  </li>   <li class=' '> <a href="#contacts" > Контакты  </a>  </li>  </ul> </div><!--/.nav-collapse --> <div class='send-brief' > <a href='#brief' role='button' data-toggle='modal'> <i class='background'></i> <span>Заполнить бриф</span> </a> </div> <h4 class='phone-desktop'> Звоните: +7 (495) 79-222-44 </h4> </div> </div></header><div class="icon-up visible-desktop" id="up" title="наверх"></div><section class="container blog" id='blog'> <h1 class='outlined-caption text-center'> <a href='/blog'>Блог Makeomatic: разработка сайтов и мобильных приложений</a> </h1>  <div class='row'> <div class='span10'><article class="post"> <div class="post-content"> <header class='post-header'>   <h2 class="title">Как использовать ngMessages в AngularJS</h2> <p class='muted'></p>   <div class="icon"></div> <time datetime="2014-05-21T07:00:00.000Z"> May 21 2014 </time>   <div class="tags"> | Категории: <a href="/blog/tags/Javascript/">Javascript</a>, <a href="/blog/tags/AngularJS/">AngularJS</a> </div> <span class='author'><img src='//www.gravatar.com/avatar/20f85f2eff5b6d1983bc8b0d1cd37a42?s=20' /> Анна Аминева</span>  </header> <section class="body">  <p><img src="/blog/images/ngmassage.jpg" alt="Иллюстрация блокнота"></p>
<p>##Что за ngMessage?</p>
<p><code>ngMessages</code> - новая возможность в AngularJS 1.3 для отображения сообщений об ошибках в формах. Работа с формами в Ангуляре является сказкой, так как она основана на взаимодействии с базовыми формами HTML, и их органичном расширении. Директива <code>ngModel</code> без проблем работает со всеми полями ввода, а состояние формы может быть получено в любой момент времени, используя имя формы или конкретного поля ввода данных.<br><a id="more"></a></p>
<p>Но как на счет показа сообщений об ошибках? Поскольку нет утвержденного алгоритма для этого действия - существует много противоречивых путей для достижения нужного результата в AngularJS. Если мы показываем или скрываем сообщение - то проще использовать <code>ngIf</code> или <code>ngSwitch</code>, но если мы пытаемся отобразить множество разных сообщений во всем приложении, то код начинает становиться громоздким. Должны ли вы на самом деле использовать <code>ngIf</code>  больше 20 раз для формы только для того, чтобы показать горстку сообщений? Можем ли мы повторно использовать шаблон сообщений в других частях приложения? Действительно ли формы так сложны? </p>
<p>Новый модуль <code>ngMessages</code> представленный в AngularJS 1.3-beta.8, предназначен для отображения сообщений об ошибках с возможностью их повторного использования и легкости в поддержке. Вместо того, чтобы потрошить ваш код шаблонов размещением бесконечного числа <code>ngIf</code>, <code>ngMessages</code> смотрит на изменения объекта <code>model.$error</code> и затем решает какие сообщения показать, базируясь на том, какие ошибки описаны в шаблоне.</p>
<p>Заинтересованы? Давайте исследуем директивы <code>ngMessages</code> и <code>ngMessage</code> более детально.</p>
<h2 id="AngularJS-1-3-0-beta-8-и-выше"><a href="#AngularJS-1-3-0-beta-8-и-выше" class="headerlink" title="AngularJS 1.3.0-beta.8 и выше"></a>AngularJS 1.3.0-beta.8 и выше</h2><p>Имейте ввиду, что <code>ngMessages</code> доступы только для AngularJS 1.3.0-beta.8 или выше. К сожалению, этот функционал не доступен для 1.2 версии.</p>
<h3 id="Демо-версия-приложения"><a href="#Демо-версия-приложения" class="headerlink" title="Демо версия приложения"></a>Демо версия приложения</h3><p>В дополнение к данному руководству, эта статья так же предоставляет ссылку на  приложение демонстрационной формы, которая использует модуль <code>ngMessages</code>. Демо  не отправляет данные на сервер, но она содержит контроль вводимых данных, и отображает сообщения о многих типах  ошибок. Так же, обязательно введите имя пользователя в поле <code>username</code>, чтобы увидеть как применяется асинхронная проверка.</p>
<h2 id="Адская-работа-с-сообщениями-об-ошибках"><a href="#Адская-работа-с-сообщениями-об-ошибках" class="headerlink" title="Адская работа с сообщениями об ошибках"></a>Адская работа с сообщениями об ошибках</h2><p>Настоящая проблема с управлением сообщениями об ошибках в Ангуляре - это код, требующийся для определения того, что отображается в шаблоне. Шаблон становится слишком тяжеловесным если вся эта логика встраивается в HTML код.<br>Но хватит жаловаться. Вместо этого давайте сразу же посмотрим на пример, который показывает email адрес в форме, управляемой Ангуляром. </p>
<p>Plunkr</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"userForm"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"field"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"emailAddress"</span>&gt;</span>Enter your email address:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">name</span>=<span class="string">"emailAddress"</span> <span class="attr">ng-model</span>=<span class="string">"data.email"</span> <span class="attr">required</span> /&gt;</span></div><div class="line"><span class="comment">&lt;!-- this stuff is WAY too complex --&gt;</span> 	</div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-if</span>=<span class="string">"userForm.emailAddress.$error.required"</span> <span class="attr">class</span>=<span class="string">"error"</span>&gt;</span></div><div class="line">You forgot to enter your email address…</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-if</span>=<span class="string">"!userForm.emailAddress.$error.required &amp;&amp;                  userForm.emailAddress.$error.email"</span> <span class="attr">class</span>=<span class="string">"error"</span>&gt;</span></div><div class="line">You did not enter your email address correctly... 	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Код для организации ввода данных прост, а вот для обработки сообщений об ошибках нереально сложный. Для того, чтобы сначала показать требующееся сообщение об ошибках и после показать следующую ошибку, нам нужно установить сложную булево структуру, чтобы это сделать. Как только нам требуется отобразить больше пары сообщений об ошибках, то в теории нам надо установить все больше и больше блоков кода для обработки таких сообщений. Чтобы справиться с этой проблемой мы можем убрать логику в контроллер…</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-if</span>=<span class="string">"onlyHasError('required', myForm.emailAddress)"</span> <span class="attr">class</span>=<span class="string">"error"</span>&gt;</span>   You forgot to enter your email address... <span class="tag">&lt;/<span class="name">div</span>&gt;</span> </div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-if</span>=<span class="string">"onlyHasError('email', myForm.emailAddress)"</span> <span class="attr">class</span>=<span class="string">"error"</span>&gt;</span>   You did not enter your email address correctly... <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Но теперь код нашего шаблона сильно зависит от контроллера и его области видимости. Помимо этого, мы не можем повторно использовать этот код, так как <code>ng-if</code> выражения относятся к конкретному полю ввода email. Давайте остановимся на минутку, ведь код уже выходит из-под нашего контроля. Попробуем найти другой подход.</p>
<p>Вместо того, что полагаться на сложную обработку сообщений об ошибках, используя <code>ng-if</code> выражения, давайте использовать директиву <code>ngMessages</code>. Перво-наперво, давайте добавим <code>ngMessages</code> в наше приложение и прикрепим модуль <code>ngMessages</code> к нашему модулю приложения как зависимость.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"angular.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div><div class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"angular-messages.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div><div class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;   angular.module(<span class="string">'myApp'</span>, [<span class="string">'ngMessages'</span>]); <span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div></pre></td></tr></table></figure>
<p>Сейчас мы можем переделать наш пример с email. Давайте вырежем наши <code>ngIf</code> сообщения и завернем все внутрь <code>div</code> элемента с директивой <code>ngMessages</code> и каждым сообщением об ошибке во вложенных <code>div</code>, используя директивы <code>ngMessage</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;form name=&quot;userForm&quot;&gt; </div><div class="line">&lt;div class=&quot;field&quot;&gt;</div><div class="line">&lt;label for=&quot;emailAddress&quot;&gt;Enter your email address:&lt;/label&gt;</div><div class="line">&lt;input type=&quot;email&quot; name=&quot;emailAddress&quot; ng-model=&quot;data.email&quot; required /&gt;</div><div class="line">&lt;div ng-messages=&quot;userForm.emailAddress.$error&quot;&gt;</div><div class="line">&lt;div ng-message=&quot;required&quot;&gt;You forgot to enter your email address...&lt;/div&gt;</div><div class="line">&lt;div ng-message=&quot;email&quot;&gt;You did not enter your email address correctly...&lt;/div&gt;</div><div class="line">&lt;/div&gt;</div><div class="line">&lt;/div&gt;</div><div class="line">&lt;input type=&quot;submit&quot; /&gt;</div><div class="line">&lt;/form&gt;</div></pre></td></tr></table></figure>
<p>И это весь код, который нам нужен!</p>
<h2 id="Как-же-работает-ngMessage"><a href="#Как-же-работает-ngMessage" class="headerlink" title="Как же работает ngMessage?"></a>Как же работает <code>ngMessage</code>?</h2><p>Внешняя директива (<code>ng-messages</code>) смотрит за изменениями в объекте <code>userForm.emailAddress.$error</code>  (который содержит ключ/значение списка всех ошибках, представленных в моделе email адреса). Как только состояние этого объекта $error  меняется, директива <code>ng-messages</code> исследует его и содержание внутренних директив (директивы <code>ng-message</code>) и выбирает первый элемент директивы, для которого проверка на ошибку выдала <code>true</code>.</p>
<p>Давайте расширим наши проверки и добавим валидацию минимальной и максимальной длины в наш элемент email поля. Как мы теперь структурируем наш код сообщения?</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"userForm"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"field"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"emailAddress"</span>&gt;</span>Enter your email address:<span class="tag">&lt;/<span class="name">label</span>&gt;</span> 	</div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span>        	<span class="attr">name</span>=<span class="string">"emailAddress"</span>            <span class="attr">ng-model</span>=<span class="string">"data.email"</span>        	<span class="attr">ng-minlength</span>=<span class="string">"5"</span>        	<span class="attr">ng-maxlength</span>=<span class="string">"30"</span>        	<span class="attr">required</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-messages</span>=<span class="string">"userForm.emailAddress.$error"</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- the required message is displayed first... →</span></div><div class="line">&lt;div ng-message="required"&gt;You forgot to enter your email address...&lt;/div&gt;</div><div class="line">&lt;!-- then, incase the message is too short, show the message right after →</div><div class="line">&lt;div ng-message="minlength"&gt;Your email address is too short...&lt;/div&gt; </div><div class="line">&lt;!-- of if is too long then let us know --&gt; </div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-message</span>=<span class="string">"maxlength"</span>&gt;</span>Your email address is too long...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- otherwise let us know if the email itself is invalid --&gt;</span>   	</div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-message</span>=<span class="string">"email"</span>&gt;</span>You did not enter your email address correctly...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Этот интуитивный подход к порядку демонстрации ошибок полностью контролируется порядок отображения в <code>DOM</code>. Вместо того, чтобы полагаться на <code>ngIf</code> выражения, для установки сложных логических конструкций, <code>ngMessages</code> уважает порядок внутренних ng-message DOM элементов и ведет себя соответственно. Но как насчет того, если мы захотели показать все сообщения, а не по одному? Это может быть сделано путем добавления <code>ng-messages-multiple</code> атрибута в контейнер <code>g-messages</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;!-- now everthing will show up whenever the errors are met →</div><div class="line">&lt;div ng-messages=&quot;userForm.emailAddress.$error&quot; ng-messages-multiple&gt;</div><div class="line">&lt;div ng-message=&quot;required&quot;&gt;...&lt;/div&gt;</div><div class="line">&lt;div ng-message=&quot;minlength&quot;&gt;...&lt;/div&gt;</div><div class="line">&lt;div ng-message=&quot;maxlength&quot;&gt;...&lt;/div&gt;</div><div class="line">&lt;div ng-message=&quot;email&quot;&gt;...&lt;/div&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>Так же, имейте в виду, что мы можем использовать директивы элемента вместо аттрибутов.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- now everthing will show up whenever the errors are met →</span></div><div class="line">&lt;ng-messages for="userForm.emailAddress.$error" multiple&gt;</div><div class="line">&lt;ng-message when="required"&gt;...&lt;/ng-message&gt;</div><div class="line">&lt;ng-message when="minlength"&gt;...&lt;/ng-message&gt;</div><div class="line">&lt;ng-message when="maxlength"&gt;...&lt;/ng-message&gt;</div><div class="line">&lt;ng-message when="email"&gt;...&lt;/ng-message&gt;</div><div class="line">&lt;/ng-messages&gt;</div></pre></td></tr></table></figure>
<p>Такой подход намного лучше чем множество <code>ngIf</code> выражений. Но мы до сих пор мы зависим от выражений, которые жестко привязаны к конкретной моделе в форме. Как мы можем повторно использовать эти сообщения? </p>
<p>###Повторное использование и переопределение сообщений об ошибке</p>
<p>Сообщения об ошибке могут быть повторно использованы через блок <code>ngMessages</code>, путем включения удаленного (или встроенного) шаблона используя <code>ng-messages-include</code> аттрибут. Давайте создадим общий шаблон, где необходимая, минимальная и максимальная длина сообщений об ошибке сохранена. Сначала создадим файл удаленного шаблона, который содержит наши сообщения об ошибке. </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- remote file: error-messages.html --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-message</span>=<span class="string">"required"</span>&gt;</span>You left the field blank...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-message</span>=<span class="string">"minlength"</span>&gt;</span>Your field is too short<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-message</span>=<span class="string">"maxlength"</span>&gt;</span>Your field is too long<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-message</span>=<span class="string">"email"</span>&gt;</span>Your field has an invalid email address<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>А сейчас создадим нашу форму, и воспользуемся шаблоном..<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"userForm"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"field"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"emailAddress"</span>&gt;</span>Enter your email address:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span>            <span class="attr">name</span>=<span class="string">"emailAddress"</span>            <span class="attr">ng-model</span>=<span class="string">"data.email"</span>            <span class="attr">ng-minlength</span>=<span class="string">"5"</span>        	<span class="attr">ng-maxlength</span>=<span class="string">"30"</span>        	<span class="attr">required</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-messages</span>=<span class="string">"userForm.emailAddress.$error"</span>          <span class="attr">ng-messages-include</span>=<span class="string">"error-messages.html"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>Отлично. Сейчас мы можем снова использовать шаблон <code>error-messages</code> как основу для наших сообщений об ошибках для других полей ввода в нашей форме. Сейчас наше сообщения об ошибке выглядит как будто оно составлено роботом. Все описано общими словами. В них нет любви. Положительные эмоции от использования форм возникнут тогда, когда каждая ошибка будет специфична каждому куску данных, который собран в форме.  Давайте добавим обратно необходимое сообщение и не будем использовать другое, определенное в шаблоне. Но подождите секундочку! Как, в самом деле, одно сообщение может быть использовано, а остальные нет? Можем ли мы только разместить ту же директиву назад внутрь контейнера <code>ng-messages</code>? Да. И делая это так что сообщение, определенное в шаблоне будет заменено любой директивой, присутствующей в контейнере.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-messages</span>=<span class="string">"userForm.emailAddress.$error"</span>  	<span class="attr">ng-messages-include</span>=<span class="string">"error-messages"</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- only the required error message is replaced. The other ones are still there... →</span></div><div class="line">&lt;div ng-message="required"&gt;You did not enter an email address&lt;/div&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>Порядок сообщений до сих пор тот же (с <code>required</code> сообщением, появляющимся первым), но вместо того, чтобы показать обобщенное, сформированное “роботом” сообщение об ошибке, будет использовано сообщение сформированное в <code>ng-messages</code> директиве. Таким образом мы можем выбрать те сообщения, которые нужно оставить, и те, которые нужно перезаписать.</p>
<h3 id="Кастомные-проверки-и-сообщения-об-ошибке"><a href="#Кастомные-проверки-и-сообщения-об-ошибке" class="headerlink" title="Кастомные проверки и сообщения об ошибке"></a>Кастомные проверки и сообщения об ошибке</h3><p>Кастомные проверки могут быть созданы добавлением директив, включением контроллера ngModel и, после, добавлением валидации в массив <code>$parsers</code> (массив <code>$formatters</code> быть использован в том числе, но <code>$parsers</code> лучше подходят для таких проверок). Давайте создадим валидатор, который будет проверять, доступен ли email адрес в нашей базе данных через вызов GET API.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">myApp.directive(<span class="string">'recordAvailabilityValidator'</span>,   [<span class="string">'$http'</span>, </div><div class="line"><span class="function"><span class="keyword">function</span>(<span class="params">$http</span>) </span>&#123;	</div><div class="line"><span class="keyword">return</span> &#123; 	</div><div class="line"><span class="attr">require</span> : <span class="string">'ngModel'</span>, 	</div><div class="line"><span class="attr">link</span> : <span class="function"><span class="keyword">function</span>(<span class="params">scope, element, attrs, ngModel</span>) </span>&#123;   	</div><div class="line"><span class="keyword">var</span> apiUrl = attrs.recordAvailabilityValidator;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">setAsLoading</span>(<span class="params">bool</span>) </span>&#123;</div><div class="line">ngModel.$setValidity(<span class="string">'recordLoading'</span>, !bool);   	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">setAsAvailable</span>(<span class="params">bool</span>) </span>&#123;</div><div class="line">ngModel.$setValidity(<span class="string">'recordAvailable'</span>, bool);</div><div class="line">    	&#125;    	</div><div class="line"></div><div class="line">ngModel.$parsers.push(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</div><div class="line"><span class="keyword">if</span>(!value || value.length == <span class="number">0</span>) <span class="keyword">return</span>;</div><div class="line"></div><div class="line">setAsLoading(<span class="literal">true</span>);</div><div class="line">setAsAvailable(<span class="literal">false</span>);</div><div class="line">$http.get(apiUrl, &#123; <span class="attr">v</span> : value &#125;)</div><div class="line">.success(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">setAsLoading(<span class="literal">false</span>);</div><div class="line">setAsAvailable(<span class="literal">true</span>);</div><div class="line">&#125;)</div><div class="line">.error(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">setAsLoading(<span class="literal">false</span>);</div><div class="line">setAsAvailable(<span class="literal">false</span>);</div><div class="line">&#125;);</div><div class="line"><span class="keyword">return</span> value;   	</div><div class="line">&#125;)     </div><div class="line">&#125;</div><div class="line">&#125; </div><div class="line">&#125;]);</div></pre></td></tr></table></figure>
<p>Наш валидатор достаточно хорош и может быть использован где нам угодно раз. Мы можем использовать его для проверки, доступен ли email адрес и мы можем даже использовать его для других вещей, типа проверки уникальности имен пользователей или значений <code>ID</code> пользователя. После того, как мы использовали метод <code>ngModel.$setValidity</code> и предоставили ошибочное имя, ошибка появится в моделе объекта <code>$error</code>. Поэтому, чтобы показать 2 сообщения (сообщение о проходящей проверке и сообщение о доступности) - нужно всего лишь расположить их в нужном порядке в директиве <code>ngMessage</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;!-- now everthing will show up whenever the errors are met →</div><div class="line">&lt;div ng-messages=&quot;userForm.emailAddress.$error&quot; ng-messages-multiple&gt;</div><div class="line">&lt;div ng-message=&quot;required&quot;&gt;...&lt;/div&gt;</div><div class="line">&lt;div ng-message=&quot;minlength&quot;&gt;...&lt;/div&gt;</div><div class="line">&lt;div ng-message=&quot;maxlength&quot;&gt;...&lt;/div&gt;</div><div class="line">&lt;div ng-message=&quot;email&quot;&gt;...&lt;/div&gt;</div><div class="line">&lt;div ng-message=&quot;recordLoading&quot;&gt;Checking database...&lt;/div&gt;</div><div class="line">&lt;div ng-message=&quot;recordAvailable&quot;&gt;The email address is already in use...&lt;/div&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>Сейчас сообщения <code>recordLoading</code> и <code>recordAvailable</code> показываются каждый раз после изменения email адреса. На текущий момент код валидатора не идеален - он не проверяет на наличие других ошибок, и не завершает предыдущие XHR запросы - оставим это как упражнение читателю.</p>
<p>Если вы мечтаете увидеть пример этого, пожалуйста посмотрите демонстрационное приложение и введите значение имени пользователя.</p>
<p>##Хуки анимации</p>
<p>Так как <code>ngMessages</code> и<code>ngMessage</code> директивы используют сервис <code>$animate</code>, чтобы управлять  DOM операциями, анимации могут быть использованы всякий раз, когда сообщения об ошибке поменялись местами или когда у нас нет сообщений об ошибках вообще. Эти хуки могут позволить нам добавить интересные анимации когда возникают ошибка.</p>
<p>###Анимации с ng-message</p>
<p>Внутренние директивы ng-message добавляют вставку и удаляют себя, которые в свою очередь инициализируют <code>enter</code> и <code>leaveanimation</code> события.</p>
<p>##Смотря в будущее</p>
<p><code>NgMessages</code> - экспериментальный модуль. Это не говорит о том, что он будет однажды удален, напротив это значит, что API может поменяться, пока он не станет полностью стабильным. Поэтому если существуют некоторые баги или отсутствуют определенные возможности, которые, как вам кажется, идеально подойдут, пожалуйста, создайте задачу в гитхабе!<br>Спасибо вам, что уделили время моей статье.</p>
  </section> <footer class='post-footer clearfix'>   <div class="addthis_toolbox addthis_default_style pull-right"> <a class="addthis_button_facebook"></a> <a class="addthis_button_twitter"></a> <a class="addthis_button_vk"></a> <a class="addthis_button_compact"></a> <a class="addthis_counter addthis_bubble_style"></a></div><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>  </footer> </div></article><section id="comment"> <h3 class="title">Комментарии</h3> <div id="disqus_thread"> <noscript>Включите Javascript, чтобы просмотреть <a href="//disqus.com/?ref_noscript">комментарии с помощью Disqus.</a></noscript> </div></section></div> <aside class="span2">  <div class="widget tag"> <h3 class="title">Тэги</h3> <ul class="unstyled">  <li> <span class='badge'>31</span> <a href="/blog/tags/AngularJS/"> AngularJS </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/CSS/"> CSS </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Chef/"> Chef </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Coffee-script/"> Coffee-script </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Cordova/"> Cordova </a> </li>  <li> <span class='badge'>5</span> <a href="/blog/tags/ElasticSearch/"> ElasticSearch </a> </li>  <li> <span class='badge'>5</span> <a href="/blog/tags/FAQ/"> FAQ </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/GitHub/"> GitHub </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/HTML5/"> HTML5 </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/ItProjects/"> ItProjects </a> </li>  <li> <span class='badge'>30</span> <a href="/blog/tags/Javascript/"> Javascript </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Mongoose/"> Mongoose </a> </li>  <li> <span class='badge'>11</span> <a href="/blog/tags/Node-js/"> Node.js </a> </li>  <li> <span class='badge'></span> <a href="/blog/tags/NodeJS/"> NodeJS </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Objective-C/"> Objective-C </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/PhoneGap/"> PhoneGap </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/RabbitMQ/"> RabbitMQ </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/SEO/"> SEO </a> </li>  <li> <span class='badge'>3</span> <a href="/blog/tags/SQL/"> SQL </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/YAC2014/"> YAC2014 </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/bash/"> bash </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/iOS7/"> iOS7 </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/jQuery/"> jQuery </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Бизнес-модель/"> Бизнес модель </a> </li>  <li> <span class='badge'>4</span> <a href="/blog/tags/Для-новичков/"> Для новичков </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Жизнь-компании/"> Жизнь компании </a> </li>  </ul></div></aside> </div></section> <!-- /container --><footer id='contacts' class='footer-main'> <div class='callback'> <div class='container'> <div class='row'> <div class='span12'> <h2 class='xlarge'>Есть вопросы или предложения?</h2> <p class='outlined-caption'>закажите обратный звонок и наш менеджер перезвонит вам</p> <form method='POST' action='/brief' id='callback'> <ul class='hidden error'></ul> <input type="text" name='name' placeholder="Как к вам обратиться?" class='span12' required /> <input type="text" name='phone' placeholder="По какому номеру звонить?" class='span6' /> <input type="email" name='email' placeholder="E-mail (опционально)" class='span6 pull-right' /> <textarea name='question' placeholder="Ваш вопрос (опционально)" class='span12'></textarea> <button type="submit" class='blue-plank'>Заказать звонок</button> </form> </div> </div> </div> </div> <div class='container'> <div class='row'> <div class='span6'> <h4 class='footer-caption'>Разделы сайта</h4> <ul class="nav inline">  <li><a href="/blog">Блог</a></li>  <li><a href="/team">Команда</a></li>  <li><a href="#about">О нас</a></li>  <li><a href="#portfolio">Портфолио</a></li>  <li><a href="#tech">Технологии</a></li>  <li><a href="#contacts">Контакты</a></li>  <li><a href='https://github.com/AVVSDevelopment/avvs.co'>Проект на GitHub</a></li> </ul> <p class='copyright'>Makeomatic, (c) 2012-2016<br/>Разработка сайтов и мобильных приложений</p> </div> <div class='span6 blue-line'> <h4 class='footer-caption'>Контакты</h4> <p> тел: +7 (495) 79-222-44 </p> <p> e-mail: <a href="mailto:getstarted@makeomatic.ru">getstarted@makeomatic.ru</a> </p> <address> Россия, Москва, Ленинский пр-т, дом 30а<br/>индекс: 111555 </address> <div class="social"> <a class="fcb fa-stack fa-lg" href="https://www.facebook.com/makeomatic"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-facebook fa-stack-1x fa-inverse"></i> </a> <a class="fa-stack fa-lg" href="http://vk.com/makeomatic"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-vk fa-stack-1x fa-inverse"></i> </a> <a class="twt fa-stack fa-lg" href="https://twitter.com/MakeOmatic"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i> </a> <a class="gp fa-stack fa-lg" href="https://google.com/+MakeomaticRu"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-google-plus fa-stack-1x fa-inverse"></i> </a> </div> </div> </div> </div></footer><div class="modal hide fade brief" id='brief'> <div class="modal-body"> <div class='text-center'> <h2 class='brief-header outlined-caption'>Расскажите нам о вашем проекте</h2> <p class='small'> Коротко опишите ваши идеи или просто прикрепите файл с готовым ТЗ.<br/> Мы свяжемся с вами в течение 1 дня и подробно расскажем о том, как мы можем вам помочь. </p> </div> <form method='POST' action='/brief' class='callback'> <input type="text" name='name' placeholder="Как к вам обратиться?" class='span10' required /> <input type="text" name='phone' placeholder="По какому номеру звонить?" class='span5' /> <input type="email" name='email' placeholder="E-mail (опционально)" class='span5 pull-right' /> <textarea name='question' placeholder="Краткое описание вашего проекта" class='span7'></textarea> <div class='dropbox pull-right' id='dropbox' ></div> <button class="blue-plank pull-right" type='submit'>Отправить</button> </form> </div></div><!-- scripts --><script src="/js/app.min.2.3.1.js" charset="UTF-8" ></script><!-- end scripts --><script type="text/javascript">var disqus_shortname = 'makeomatic';(function(){ var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);}());</script><!-- Yandex.Metrika counter --><script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter15629977 = new Ya.Metrika({id:15629977, webvisor:true, clickmap:true, trackLinks:true, accurateTrackBounce:true, trackHash:true, ut:"noindex"}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="//mc.yandex.ru/watch/15629977?ut=noindex" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter --><!-- google analytics --><script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-40638966-1', 'makeomatic.ru'); ga('send', 'pageview');</script></body></html>