<!DOCTYPE html><!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="ru"> <![endif]--><!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang="ru"> <![endif]--><!--[if IE 8]>         <html class="no-js lt-ie9" lang="ru"> <![endif]--><!--[if gt IE 8]><!--> <html class="no-js" lang="ru"> <!--<![endif]--><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#"> <meta charset="utf-8">  <title>Разбираемся с системой событий $emit, $broadcast и $on в $scope и $rootScope Ангуляра | Блог Makeomatic: разработка сайтов и мобильных приложений</title> <meta name="author" content="Makeomatic">  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"> <!-- For third-generation iPad with high-resolution Retina display: --> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144x144-precomposed.png"> <!-- For iPhone with high-resolution Retina display running iOS ≥ 7: --> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/apple-touch-icon-120x120-precomposed.png"> <!-- For iPhone with high-resolution Retina display running iOS ≤ 6: --> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/apple-touch-icon-114x114-precomposed.png"> <!-- For first- and second-generation iPad: --> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/apple-touch-icon-72x72-precomposed.png"> <!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: --> <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"> <meta name="description" content="$emit, $broadcast и $on Ангуляра попадают под общий концепт “publish/subscribe”, так же называемый “могу сделать”, в которой вы публикуете событие и подписываетесь/отписываетесь от него еще где-то. С">
<meta name="keywords" content="Javascript,AngularJS">
<meta property="og:type" content="article">
<meta property="og:title" content="Разбираемся с системой событий $emit, $broadcast и $on в $scope и $rootScope Ангуляра">
<meta property="og:url" content="https://makeomatic.ru/blog/2014/10/07/Angular_scope_rootScope/index.html">
<meta property="og:site_name" content="Блог Makeomatic: разработка сайтов и мобильных приложений">
<meta property="og:description" content="$emit, $broadcast и $on Ангуляра попадают под общий концепт “publish/subscribe”, так же называемый “могу сделать”, в которой вы публикуете событие и подписываетесь/отписываетесь от него еще где-то. С">
<meta property="og:image" content="https://makeomatic.ru/blog/images/angular_scope.png">
<meta property="og:updated_time" content="2016-01-08T17:55:51.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Разбираемся с системой событий $emit, $broadcast и $on в $scope и $rootScope Ангуляра">
<meta name="twitter:description" content="$emit, $broadcast и $on Ангуляра попадают под общий концепт “publish/subscribe”, так же называемый “могу сделать”, в которой вы публикуете событие и подписываетесь/отписываетесь от него еще где-то. С">
<meta name="twitter:image" content="https://makeomatic.ru/blog/images/angular_scope.png">
<meta name="twitter:creator" content="@makeomatic">
<link rel="publisher" href="https://plus.google.com/+MakeomaticRu">  <link rel="alternate" hreflang="ru" href="hhttps:&#47;&#47;makeomatic.ru&#47;blog&#47;2014&#47;07&#47;10&#47;Angular_scope_rootScope&#47;" />   <meta property="og:image:width" content="623" /> <meta property="og:image:height" content="416" />  <link href='//fonts.googleapis.com/css?family=Roboto:300,700&subset=latin,cyrillic,cyrillic-ext' rel='stylesheet' type='text/css'>  <link rel="stylesheet" href="/css/app.min.2.3.1.css">  <script src="/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script> <!-- place this in your head tag --> <!-- <script src='https://js.tito.io/v1' async></script> --> <!-- <link rel="stylesheet" type="text/css" href='https://css.tito.io/v1' /> --></head><body data-spy="scroll" data-target=".navbar" data-offset="150"><!--[if lt IE 8]><p class="chromeframe">Вы используете <strong>устаревший</strong> браузер. Пожалуйста <a href="http://browsehappy.com/">обновите ваш браузер</a> или <a href="http://www.google.com/chromeframe/?redirect=true">активируйте Google Chrome Frame</a>, чтобы улучшить ваши впечатления от посещения сайта.</p><![endif]--><header class="navbar navbar-inverse navbar-fixed-top"> <div class="navbar-inner"> <div class="container"> <div class="social-desktop"> <a class="fcb" href="https://www.facebook.com/makeomatic"> <i class="fa fa-facebook"></i> </a> <a class="vk" href="https://vk.com/makeomatic"> <i class="fa fa-vk"></i> </a> <a class="twt" href="https://twitter.com/MakeOmatic"> <i class="fa fa-twitter"></i> </a> <a class="gp" href="https://google.com/+MakeomaticRu"> <i class="fa fa-google-plus-square"></i> </a> </div> <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a> <a class="brand" href="/">makeomatic</a> <div class="nav-collapse collapse"> <ul class="nav">   <li class='active '> <a href="/blog" > Блог  </a>  </li>   <li class=' dropdown'> <a href="/team" data-target="#" class="dropdown-toggle" data-toggle="dropdown"> Команда  <b class='caret'></b>  </a>  <ul class='dropdown-menu'>   <li> <a href="/team#vyacheslavgusev">Вячеслав Гусев</a> </li>   <li> <a href="/team#vitaliiaminev">Виталий Аминев</a> </li>   <li> <a href="/team#annaamineva">Анна Аминева</a> </li>   <li> <a href="/team#andreiafoninskii">Андрей Афонинский</a> </li>   <li> <a href="/team#aleksandrkremenets">Александр Кременец</a> </li>   <li> <a href="/team#dmitriigorbunov">Дмитрий Горбунов</a> </li>   <li> <a href="/team#evgeniipoyarkov">Евгений Поярков</a> </li>   <li> <a href="/team#ilyaovsyannikov">Илья Овсянников</a> </li>  </ul>  </li>   <li class=' '> <a href="/#about" > О нас  </a>  </li>   <li class=' dropdown'> <a href="/#portfolio" data-target="#" class="dropdown-toggle" data-toggle="dropdown"> Портфолио  <b class='caret'></b>  </a>  <ul class='dropdown-menu'>   <li> <a href="/#Distribut.io">Distribut.io</a> </li>   <li> <a href="/#Recordi">Recordi</a> </li>   <li> <a href="/#Photobot">Photobot</a> </li>   <li> <a href="/#BrainsApp">BrainsApp</a> </li>   <li> <a href="/#FabrikaTepla">FabrikaTepla</a> </li>   <li> <a href="/#SpeakGeo">SpeakGeo</a> </li>   <li> <a href="/#OpenInclude">OpenInclude</a> </li>   <li> <a href="/#LIVEONE">LIVEONE</a> </li>   <li> <a href="/#FitCafe">FitCafe</a> </li>  </ul>  </li>   <li class=' '> <a href="/#tech" > Технологии  </a>  </li>   <li class=' '> <a href="#contacts" > Контакты  </a>  </li>  </ul> </div><!--/.nav-collapse --> <div class='send-brief' > <a href='#brief' role='button' data-toggle='modal'> <i class='background'></i> <span>Заполнить бриф</span> </a> </div> <h4 class='phone-desktop'> Звоните: +7 (495) 79-222-44 </h4> </div> </div></header><div class="icon-up visible-desktop" id="up" title="наверх"></div><section class="container blog" id='blog'> <h1 class='outlined-caption text-center'> <a href='/blog'>Блог Makeomatic: разработка сайтов и мобильных приложений</a> </h1>  <div class='row'> <div class='span10'><article class="post"> <div class="post-content"> <header class='post-header'>   <h2 class="title">Разбираемся с системой событий $emit, $broadcast и $on в $scope и $rootScope Ангуляра</h2> <p class='muted'></p>   <div class="icon"></div> <time datetime="2014-10-07T07:00:00.000Z"> Oct 7 2014 </time>   <div class="tags"> | Категории: <a href="/blog/tags/Javascript/">Javascript</a>, <a href="/blog/tags/AngularJS/">AngularJS</a> </div> <span class='author'><img src='//www.gravatar.com/avatar/20f85f2eff5b6d1983bc8b0d1cd37a42?s=20' /> Анна Аминева</span>  </header> <section class="body">  <p><img src="/blog/images/angular_scope.png" alt="Иллюстрация блокнота"></p>
<p><code>$emit</code>, <code>$broadcast</code> и <code>$on</code> Ангуляра попадают под общий концепт “publish/subscribe”, так же называемый “могу сделать”, в которой вы публикуете событие и подписываетесь/отписываетесь от него еще где-то. Система событий в AngularJS великолепна, что делает вещи безупречными и легкими в исполнении (как и следовало ожидать!), но концепт, который стоит за этой простотой не так легок для освоения в совершенстве, поэтому очень часто у вас будет возникать недоумение по поводу того, почему все работает не так, как вы думаете.<br><a id="more"></a></p>
<p>Для тех, кому работа с Ангуляром в новинку, и кто не использовал или не видел <code>$emit</code>, <code>$broadcast</code>или <code>$on</code>, поясним, что они делают, перед тем, как мы рассмотрим <code>$scope</code> и <code>$rootScope</code>отношения событий, областей видимости и того, как корректно применить данную систему событий, а так же поймем, что же действительно происходит.</p>
<h3 id="scope-emit-вверх-scope-broadcast-вниз"><a href="#scope-emit-вверх-scope-broadcast-вниз" class="headerlink" title="$scope.$emit вверх, $scope.$broadcast вниз"></a>$scope.$emit вверх, $scope.$broadcast вниз</h3><p>Используя <code>$scope.$emit</code>- событие запускается вверх по области видимости. Используя <code>$scope.$broadcast</code>- событие запускается вниз по области видимости. Когда мы используем <code>$scope.$on</code> - мы “подписываемся” на прослушивание данных событий. Быстрый пример:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// запускаем событие вверх</span></div><div class="line">$scope.$emit(<span class="string">'myCustomEvent'</span>, <span class="string">'Data to send'</span>);</div><div class="line"></div><div class="line"><span class="comment">// запускаем событие вниз</span></div><div class="line">$scope.$broadcast(<span class="string">'myCustomEvent'</span>, &#123;</div><div class="line">  <span class="attr">someProp</span>: <span class="string">'Sending you an Object!'</span> <span class="comment">// посылайте что хотите</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// слушаем событие в нужном нам $scope</span></div><div class="line">$scope.$on(<span class="string">'myCustomEvent'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event, data</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(data); <span class="comment">// Данные, которые нам прислали</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="scope-emit-broadcast"><a href="#scope-emit-broadcast" class="headerlink" title="$scope.($emit/$broadcast)"></a>$scope.($emit/$broadcast)</h3><p>Ключевой момент для запоминания при использовании <code>$scope</code> для запуска ваших событий - это то, что они будут коммуницировать только с непосредственной родительской областью видимости или с ближайшими потомками! При этом области видимости не всегда потомки или родители: у нас могут быть “братские” области видимости, к примеру, с одним и тем же родителем. Используя <code>$scope</code> для запуска, мы пропустим такие области видимости и запустим его лишь вниз или вверх, но никогда не по сторонам.</p>
<p>Самый простой путь имитации родительских и дочерних областей видимости - использовать контроллеры. Каждый контроллер создает новый <code>$scope</code>, который Ангуляр аккуратно выводит для нас в виде класса <code>ng-scope</code> на элементах, с новыми областями видимости:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"ParentCtrl as parent"</span> <span class="attr">class</span>=<span class="string">"ng-scope"</span>&gt;</span></div><div class="line">  &#123; &#123; parent.data &#125; &#125;</div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"SiblingOneCtrl as sib1"</span> <span class="attr">class</span>=<span class="string">"ng-scope"</span>&gt;</span></div><div class="line">      &#123; &#123; sib1.data &#125; &#125;</div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Мы могли бы запустить событие вниз из <code>ParentCtrl</code> в <code>SiblingOneCtrl</code>, используя <code>$broadcast</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">app.controller(<span class="string">'ParentCtrl'</span>,</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ParentCtrl</span> (<span class="params">$scope</span>) </span>&#123;</div><div class="line"></div><div class="line">  $scope.$broadcast(<span class="string">'parent'</span>, <span class="string">'Some data'</span>); <span class="comment">// идет вниз!</span></div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">app.controller(<span class="string">'SiblingOneCtrl'</span>,</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">SiblingOneCtrl</span> (<span class="params">$scope</span>) </span>&#123;</div><div class="line"></div><div class="line">  $scope.$on(<span class="string">'parent'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event, data</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(data); <span class="comment">// ‘Some data’</span></div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Если бы мы захотели передать сигнал вверх, из <code>SiblingOneCtrl</code> в <code>ParentCtrl</code>, как вы уже догадались, вы можете использовать <code>$emit</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">app.controller(<span class="string">'ParentCtrl'</span>,</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ParentCtrl</span> (<span class="params">$scope</span>) </span>&#123;</div><div class="line">  $scope.$on(<span class="string">'child'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event, data</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(data); <span class="comment">// 'Some data'</span></div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">app.controller(<span class="string">'SiblingOneCtrl'</span>,</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">SiblingOneCtrl</span> (<span class="params">$scope</span>) </span>&#123;</div><div class="line"></div><div class="line">  $scope.$emit(<span class="string">'child'</span>, <span class="string">'Some data'</span>); <span class="comment">// идем наверх!</span></div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Чтобы продемонстрировать как <code>$scope</code>работает, в момент запуска события, вот простая иерархия:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;div ng-controller=<span class="string">"ParentCtrl as parent"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"ng-scope"</span>&gt;</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"SiblingOneCtrl as sib1"</span> <span class="attr">class</span>=<span class="string">"ng-scope"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div><div class="line">  &lt;div ng-controller=<span class="string">"SiblingTwoCtrl as sib2"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"ng-scope"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div><div class="line">&lt;<span class="regexp">/div&gt;</span></div></pre></td></tr></table></figure>
<p>Если <code>SiblingTwoCtrl</code> запустил <code>$scope.$broadcast</code>, тогда <code>SiblingOneCtrl</code> никогда не узнает, что случилось. Это может быть помехой, ее можно исправить, поставив небольшой костыль:</p>
<p><code>$scope.$parent.$broadcast(&#39;myevent&#39;, &#39;Some data&#39;);</code></p>
<p>Данный код обращается к <code>ParentCtrl</code> и уже оттуда запускает событие через<code>$broadcast</code></p>
<h3 id="rootScope-emit-broadcast"><a href="#rootScope-emit-broadcast" class="headerlink" title="$rootScope.($emit/$broadcast)"></a>$rootScope.($emit/$broadcast)</h3><p>Если вам все еще просто, то давайте добавим <code>$rootScope</code>. <code>$rootScope</code> - родительский элемент всех областей видимости, который делает каждый вновь созданный <code>$scope</code> его потомком! Выше я упомянул о том, как  <code>$scope</code>ограничен в направлениях распространения событий, а вот<code>$rootScope</code>- это то, как мы можем с легкостью передавать сигнал через все области видимостей. Данный подход будет решать некоторые проблемы с большей легкостью. К сожалению, все не настолько просто, как с передачей событий вверх или вниз…</p>
<h4 id="rootScope-emit-против-rootScope-broadcast"><a href="#rootScope-emit-против-rootScope-broadcast" class="headerlink" title="$rootScope.$emit против $rootScope.$broadcast"></a>$rootScope.$emit против $rootScope.$broadcast</h4><p>Объект $rootScope имеет аналогичные методы <code>$emit</code>, <code>$broadcast</code>и <code>$on</code>, но они работают немного иначе, нежели в <code>$scope</code>. Так как <code>$rootScope</code> не имеет <code>$parent</code> (родительской области видимости), использование $emit  было бы бессмысленным. Вместо этого <code>$rootScope.$emit</code> запустит событие только для слушателей, подписанных через <code>$rootScope.$on</code>. Самое интересное в том, что <code>$rootScope.$broadcast</code>уведомит как все <code>$rootScope.$on</code>, так и <code>$scope.$on</code> слушателей и это тонкое, но очень важное отличие, которое поможет избежать проблем с вашим приложением.</p>
<h4 id="rootScope-примеры"><a href="#rootScope-примеры" class="headerlink" title="$rootScope примеры"></a>$rootScope примеры</h4><p>Давайте рассмотрим еще более глубокую иерархию:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"ParentCtrl as parent"</span> <span class="attr">class</span>=<span class="string">"ng-scope"</span>&gt;</span></div><div class="line">  // ParentCtrl</div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"SiblingOneCtrl as sib1"</span> <span class="attr">class</span>=<span class="string">"ng-scope"</span>&gt;</span></div><div class="line">    // SiblingOneCtrl</div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"SiblingTwoCtrl as sib2"</span> <span class="attr">class</span>=<span class="string">"ng-scope"</span>&gt;</span></div><div class="line">    // SiblingTwoCtrl</div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"ChildCtrl as child"</span> <span class="attr">class</span>=<span class="string">"ng-scope"</span>&gt;</span></div><div class="line">      // ChildCtrl</div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>В примере выше есть 3 лексические области видимости (где родительские области видимости доступны в текущей области видимости, несколько разрывает голову при мысли об этом с точки зрения определения областей видимостей в DOM, но концептуально то что нам нужно там) и 4 области видимости в Ангуляре: <code>ParentCtrl</code>, <code>SiblingOneCtrl</code>, <code>SiblingTwoCtrl</code> и <code>ChildCtrl</code>. Две “братские” области видимости.</p>
<p>Используя <code>$scope.$emit</code>внутри <code>ChildCtrl</code> выльется в то,  что только <code>SiblingTwoCtrl</code> и <code>ParentCtrl</code> получат уведомления, так как событие вообще не распространилось на сиблингов, и затронуло лишь прямых предков (полностью игнорируя <code>SiblingOneCtrl</code>). Если бы мы использовали <code>$rootScope</code>, тогда бы мы могли затронуть и слушателей событий в  <code>$rootScope</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">app.controller(<span class="string">'SiblingOneCtrl'</span>,</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">SiblingOneCtrl</span> (<span class="params">$rootScope</span>) </span>&#123;</div><div class="line"></div><div class="line">  $rootScope.$on(<span class="string">'rootScope:emit'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event, data</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(data); <span class="comment">// 'Emit!'</span></div><div class="line">  &#125;);</div><div class="line"></div><div class="line"></div><div class="line">  $scope.$on(<span class="string">'rootScope:broadcast'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event, data</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(data); <span class="comment">// 'Broadcast!'</span></div><div class="line">  &#125;);</div><div class="line"></div><div class="line"> $rootScope.$on(<span class="string">'rootScope:broadcast'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event, data</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(data); <span class="comment">// 'Broadcast!'</span></div><div class="line">  &#125;);</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">app.controller(<span class="string">'ChildCtrl'</span>,</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ChildCtrl</span> (<span class="params">$rootScope</span>) </span>&#123;</div><div class="line">  $rootScope.$emit(<span class="string">'rootScope:emit'</span>, <span class="string">'Emit!'</span>); <span class="comment">// $rootScope.$on</span></div><div class="line">  $rootScope.$broadcast(<span class="string">'rootScope:broadcast'</span>, <span class="string">'Broadcast'</span>); <span class="comment">// $rootScope.$on &amp;&amp; $scope.$on</span></div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="Отписываемся-от-событий-в-Angular-JS"><a href="#Отписываемся-от-событий-в-Angular-JS" class="headerlink" title="Отписываемся от событий в Angular.JS"></a>Отписываемся от событий в Angular.JS</h3><p><code>unsubscribe</code> - часто системы событий в AngularJS. Вы можете прекратить прослушку событий в любое время со слушателем <code>$on</code>. В отличие от других библиотек, здесь нет <code>$off</code> метода. Документация Ангуляра не особо внятно объясняет нам то, как правильно “прекращать прослушку”, она говорит, что <code>$on</code> “Возвращает функцию отмены регистрации для слушателя событий.” Мы можем предположить, что под этим они подразумевают замыкание, которое позволит нам прекращать прослушку событий.</p>
<p>Внутри исходного кода v1.3.0-beta.11, мы можем определить местонахождение $on метода и подтвердить подозрения на наличие замыкания:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">$on: <span class="function"><span class="keyword">function</span>(<span class="params">name, listener</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> namedListeners = <span class="keyword">this</span>.$$listeners[name];</div><div class="line">  <span class="keyword">if</span> (!namedListeners) &#123;</div><div class="line">    <span class="keyword">this</span>.$$listeners[name] = namedListeners = [];</div><div class="line">  &#125;</div><div class="line">  namedListeners.push(listener);</div><div class="line"></div><div class="line">  <span class="keyword">var</span> current = <span class="keyword">this</span>;</div><div class="line">  <span class="keyword">do</span> &#123;</div><div class="line">    <span class="keyword">if</span> (!current.$$listenerCount[name]) &#123;</div><div class="line">      current.$$listenerCount[name] = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    current.$$listenerCount[name]++;</div><div class="line">  &#125; <span class="keyword">while</span> ((current = current.$parent));</div><div class="line"></div><div class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    namedListeners[indexOf(namedListeners, listener)] = <span class="literal">null</span>;</div><div class="line">    decrementListenerCount(self, <span class="number">1</span>, name);</div><div class="line">  &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Мы можем подписать и прекратить прослушку событий очень простым способом:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">app.controller(<span class="string">'ParentCtrl'</span>,</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ParentCtrl</span> (<span class="params">$scope</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">// подписываемся...</span></div><div class="line">  <span class="keyword">var</span> myListener = $scope.$on(<span class="string">'child'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event, data</span>) </span>&#123;</div><div class="line">    <span class="comment">// что-нибудь делаем</span></div><div class="line">  &#125;);</div><div class="line"></div><div class="line"></div><div class="line">  <span class="comment">// отписываемся...</span></div><div class="line">  <span class="comment">// помещаем этот код куда-нибудь в колбэк или что-то подобное</span></div><div class="line">  myListener();</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="scope-on-destroy"><a href="#scope-on-destroy" class="headerlink" title="$scope.$on $destroy"></a>$scope.$on $destroy</h3><p>Когда мы используем <code>$rootScope.$on</code>,  нам нужно отключать этих слушателей каждый раз, когда <code>$scope</code> уничтожается. Слушатели <code>$scope.$on</code> автоматически высвобождаются, но нам понадобится вызывать вышеупомянутое замыкание вручную в событии <code>$destroy</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">app.controller(<span class="string">'ParentCtrl'</span>,</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ParentCtrl</span> (<span class="params">$scope</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">// $rootScope $on</span></div><div class="line">  <span class="keyword">var</span> myListener = $rootScope.$on(<span class="string">'child'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event, data</span>) </span>&#123;</div><div class="line">    <span class="comment">//</span></div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="comment">// $scope $destroy</span></div><div class="line">  $scope.$on(<span class="string">'$destroy'</span>, myListener);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="Отмена-событий"><a href="#Отмена-событий" class="headerlink" title="Отмена событий"></a>Отмена событий</h3><p>Если вы выбрали использование <code>$emit</code>, один из слушателей событий в <code>$scope</code> может отменить его, и предотвратить распространение события вверх по цепочке. При использовании <code>$broadcast</code>событие не может быть отменено! Отмена события, которое было отправлено через <code>$emit</code> выглядит следующим образом:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$scope.$on(<span class="string">'myCustomEvent'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event, data</span>) </span>&#123;</div><div class="line">  event.stopPropagation();</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="rootScope-listeners"><a href="#rootScope-listeners" class="headerlink" title="$rootScope.$$listeners"></a>$rootScope.$$listeners</h3><p>У каждого объекта AngularJS есть некоторые свойства, мы можем покопаться в них и наблюдать за тем, что случается “под капотом”. Мы можем взглянуть на <code>$rootScope.$$listeners</code>, чтобы наблюдать за жизненным циклом слушателей.<br>Мы так же можем прекратить прослушку событий с его помощью (но я бы не советовал вам этого делать):</p>
<p><code>$rootScope.$$listeners.myEventName = [];</code></p>
<h3 id="Распределение-событий-по-пространствам-имен"><a href="#Распределение-событий-по-пространствам-имен" class="headerlink" title="Распределение событий по пространствам имен"></a>Распределение событий по пространствам имен</h3><p>Обычно, если я работаю над конкретной фабрикой, я коммуницирую с другими директивами, контроллерами или даже фабриками, используя выделенное пространство имен для более чистой имплементации <code>pub/sub</code>, что делает код последовательным и позволяет избегать конфликтов имен.<br>Если бы я строил email приложение с ящиком входящих сообщений, то мы могли бы использовать пространство имен <code>inbox</code>для этого специального раздела. Это легко иллюстрируется несколькими простыми примерами:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$scope.$emit(<span class="string">'inbox:send'</span>[, data]);</div><div class="line">$scope.$on(<span class="string">'inbox:send'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event, data</span>) </span>&#123;...&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$scope.$broadcast(<span class="string">'inbox:delete'</span>[, data]);</div><div class="line">$scope.$on(<span class="string">'inbox:delete'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event, data</span>) </span>&#123;...&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$scope.$emit(<span class="string">'inbox:save'</span>[, data]);</div><div class="line">$scope.$on(<span class="string">'inbox:save'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event, data</span>) </span>&#123;...&#125;);</div></pre></td></tr></table></figure>
<p>По мотивам <a href="http://toddmotto.com/" target="_blank" rel="external">Todd Motto</a></p>
  </section> <footer class='post-footer clearfix'>   <div class="addthis_toolbox addthis_default_style pull-right"> <a class="addthis_button_facebook"></a> <a class="addthis_button_twitter"></a> <a class="addthis_button_vk"></a> <a class="addthis_button_compact"></a> <a class="addthis_counter addthis_bubble_style"></a></div><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>  </footer> </div></article><section id="comment"> <h3 class="title">Комментарии</h3> <div id="disqus_thread"> <noscript>Включите Javascript, чтобы просмотреть <a href="//disqus.com/?ref_noscript">комментарии с помощью Disqus.</a></noscript> </div></section></div> <aside class="span2">  <div class="widget tag"> <h3 class="title">Тэги</h3> <ul class="unstyled">  <li> <span class='badge'>31</span> <a href="/blog/tags/AngularJS/"> AngularJS </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/CSS/"> CSS </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Chef/"> Chef </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Coffee-script/"> Coffee-script </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Cordova/"> Cordova </a> </li>  <li> <span class='badge'>5</span> <a href="/blog/tags/ElasticSearch/"> ElasticSearch </a> </li>  <li> <span class='badge'>5</span> <a href="/blog/tags/FAQ/"> FAQ </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/GitHub/"> GitHub </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/HTML5/"> HTML5 </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/ItProjects/"> ItProjects </a> </li>  <li> <span class='badge'>30</span> <a href="/blog/tags/Javascript/"> Javascript </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Mongoose/"> Mongoose </a> </li>  <li> <span class='badge'>11</span> <a href="/blog/tags/Node-js/"> Node.js </a> </li>  <li> <span class='badge'></span> <a href="/blog/tags/NodeJS/"> NodeJS </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Objective-C/"> Objective-C </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/PhoneGap/"> PhoneGap </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/RabbitMQ/"> RabbitMQ </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/SEO/"> SEO </a> </li>  <li> <span class='badge'>3</span> <a href="/blog/tags/SQL/"> SQL </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/YAC2014/"> YAC2014 </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/bash/"> bash </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/iOS7/"> iOS7 </a> </li>  <li> <span class='badge'>2</span> <a href="/blog/tags/jQuery/"> jQuery </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Бизнес-модель/"> Бизнес модель </a> </li>  <li> <span class='badge'>4</span> <a href="/blog/tags/Для-новичков/"> Для новичков </a> </li>  <li> <span class='badge'>1</span> <a href="/blog/tags/Жизнь-компании/"> Жизнь компании </a> </li>  </ul></div></aside> </div></section> <!-- /container --><footer id='contacts' class='footer-main'> <div class='callback'> <div class='container'> <div class='row'> <div class='span12'> <h2 class='xlarge'>Есть вопросы или предложения?</h2> <p class='outlined-caption'>закажите обратный звонок и наш менеджер перезвонит вам</p> <form method='POST' action='/brief' id='callback'> <ul class='hidden error'></ul> <input type="text" name='name' placeholder="Как к вам обратиться?" class='span12' required /> <input type="text" name='phone' placeholder="По какому номеру звонить?" class='span6' /> <input type="email" name='email' placeholder="E-mail (опционально)" class='span6 pull-right' /> <textarea name='question' placeholder="Ваш вопрос (опционально)" class='span12'></textarea> <button type="submit" class='blue-plank'>Заказать звонок</button> </form> </div> </div> </div> </div> <div class='container'> <div class='row'> <div class='span6'> <h4 class='footer-caption'>Разделы сайта</h4> <ul class="nav inline">  <li><a href="/blog">Блог</a></li>  <li><a href="/team">Команда</a></li>  <li><a href="#about">О нас</a></li>  <li><a href="#portfolio">Портфолио</a></li>  <li><a href="#tech">Технологии</a></li>  <li><a href="#contacts">Контакты</a></li>  <li><a href='https://github.com/AVVSDevelopment/avvs.co'>Проект на GitHub</a></li> </ul> <p class='copyright'>Makeomatic, (c) 2012-2016<br/>Разработка сайтов и мобильных приложений</p> </div> <div class='span6 blue-line'> <h4 class='footer-caption'>Контакты</h4> <p> тел: +7 (495) 79-222-44 </p> <p> e-mail: <a href="mailto:getstarted@makeomatic.ru">getstarted@makeomatic.ru</a> </p> <address> Россия, Москва, Ленинский пр-т, дом 30а<br/>индекс: 111555 </address> <div class="social"> <a class="fcb fa-stack fa-lg" href="https://www.facebook.com/makeomatic"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-facebook fa-stack-1x fa-inverse"></i> </a> <a class="fa-stack fa-lg" href="http://vk.com/makeomatic"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-vk fa-stack-1x fa-inverse"></i> </a> <a class="twt fa-stack fa-lg" href="https://twitter.com/MakeOmatic"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i> </a> <a class="gp fa-stack fa-lg" href="https://google.com/+MakeomaticRu"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-google-plus fa-stack-1x fa-inverse"></i> </a> </div> </div> </div> </div></footer><div class="modal hide fade brief" id='brief'> <div class="modal-body"> <div class='text-center'> <h2 class='brief-header outlined-caption'>Расскажите нам о вашем проекте</h2> <p class='small'> Коротко опишите ваши идеи или просто прикрепите файл с готовым ТЗ.<br/> Мы свяжемся с вами в течение 1 дня и подробно расскажем о том, как мы можем вам помочь. </p> </div> <form method='POST' action='/brief' class='callback'> <input type="text" name='name' placeholder="Как к вам обратиться?" class='span10' required /> <input type="text" name='phone' placeholder="По какому номеру звонить?" class='span5' /> <input type="email" name='email' placeholder="E-mail (опционально)" class='span5 pull-right' /> <textarea name='question' placeholder="Краткое описание вашего проекта" class='span7'></textarea> <div class='dropbox pull-right' id='dropbox' ></div> <button class="blue-plank pull-right" type='submit'>Отправить</button> </form> </div></div><!-- scripts --><script src="/js/app.min.2.3.1.js" charset="UTF-8" ></script><!-- end scripts --><script type="text/javascript">var disqus_shortname = 'makeomatic';(function(){ var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);}());</script><!-- Yandex.Metrika counter --><script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter15629977 = new Ya.Metrika({id:15629977, webvisor:true, clickmap:true, trackLinks:true, accurateTrackBounce:true, trackHash:true, ut:"noindex"}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="//mc.yandex.ru/watch/15629977?ut=noindex" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter --><!-- google analytics --><script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-40638966-1', 'makeomatic.ru'); ga('send', 'pageview');</script></body></html>